commit e90cbc3d1260901efc879178a15f2d90a5e17612
Author: Jonathan Winzig <jwinzig@hilscher.com>
Date:   Wed Jan 10 13:26:36 2024 +0100

    Fix Issue #8687
    
    Signed-off-by: Jonathan Winzig <jwinzig@hilscher.com>

diff --git a/library/x509_create.c b/library/x509_create.c
index 73789dad5..4ffd3b6a8 100644
--- a/library/x509_create.c
+++ b/library/x509_create.c
@@ -195,6 +195,10 @@ int mbedtls_x509_set_extension(mbedtls_asn1_named_data **head, const char *oid,
 {
     mbedtls_asn1_named_data *cur;
 
+    if (val_len > (SIZE_MAX  - 1)) {
+        return MBEDTLS_ERR_X509_BAD_INPUT_DATA;
+    }
+
     if ((cur = mbedtls_asn1_store_named_data(head, oid, oid_len,
                                              NULL, val_len + 1)) == NULL) {
         return MBEDTLS_ERR_X509_ALLOC_FAILED;

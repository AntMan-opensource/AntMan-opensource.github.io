commit 4aff1bb00224de4f5bc118f987dfd5d2fe3450d0
Author: Sergi Ã€lvarez i Capilla <pancake@nowsecure.com>
Date:   Sat Oct 30 10:53:55 2021 +0200

    Fix oobread crash in the analysis loop with corrupted ELFs (tests_64928) ##crash
    
    Reported by giantbranch of NSFOCUS TIANJI Lab

diff --git a/libr/core/canal.c b/libr/core/canal.c
index c60601f051..4eb88caf90 100644
--- a/libr/core/canal.c
+++ b/libr/core/canal.c
@@ -831,7 +831,7 @@ static bool __core_anal_fcn(RCore *core, ut64 at, ut64 from, int reftype, int de
 					const RList *syms = r_bin_get_symbols (core->bin);
 					ut64 baddr = r_config_get_i (core->config, "bin.baddr");
 					r_list_foreach (syms, iter, sym) {
-						if ((sym->paddr + baddr) == fcn->addr && !strcmp (sym->type, R_BIN_TYPE_FUNC_STR)) {
+						if (sym->type && (sym->paddr + baddr) == fcn->addr && !strcmp (sym->type, R_BIN_TYPE_FUNC_STR)) {
 							free (new_name);
 							new_name = r_str_newf ("sym.%s", sym->name);
 							break;

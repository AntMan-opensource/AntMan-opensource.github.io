commit d0ced41651b279bb054eb6390751e2d4eb84819a
Author: Aurelien David <aurelien.david@telecom-paristech.fr>
Date:   Tue Oct 17 16:32:29 2023 +0200

    gf_text_get_utf8_line: add dest buffer len check (fixes #2647)

diff --git a/src/filters/load_text.c b/src/filters/load_text.c
index 637339822..877b285a8 100644
--- a/src/filters/load_text.c
+++ b/src/filters/load_text.c
@@ -377,6 +377,10 @@ char *gf_text_get_utf8_line(char *szLine, u32 lineSize, FILE *txt_in, s32 unicod
 			GF_LOG(GF_LOG_DEBUG, GF_LOG_PARSER, ("[TXTIn] Line too long to convert to utf8 (len: %d)\n", len));
 			j = GF_ARRAY_LENGTH(szLineConv) -1 ;
 		}
+		if ( j >= lineSize ) {
+			GF_LOG(GF_LOG_DEBUG, GF_LOG_PARSER, ("[TXTIn] UT8 converted line too long for buffer (len: %d, buffer: %d)\n", j, lineSize));
+			j = lineSize-1 ;
+		}
 		szLineConv[j] = 0;
 		strcpy(szLine, szLineConv);
 		return sOK;

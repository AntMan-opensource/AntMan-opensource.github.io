commit 0e7702e06655e3b439be8fbcd57bc91539912c2f
Author: Roman Arutyunyan <arut@nginx.com>
Date:   Tue May 28 17:19:21 2024 +0400

    QUIC: ngx_quic_buffer_t use-after-free protection.
    
    Previously the last chain field of ngx_quic_buffer_t could still reference freed
    chains and buffers after calling ngx_quic_free_buffer().  While normally an
    ngx_quic_buffer_t object should not be used after freeing, resetting last_chain
    field would prevent a potential use-after-free.

diff --git a/src/event/quic/ngx_event_quic_frames.c b/src/event/quic/ngx_event_quic_frames.c
index 42b7d9f41..6ea908cc1 100644
--- a/src/event/quic/ngx_event_quic_frames.c
+++ b/src/event/quic/ngx_event_quic_frames.c
@@ -648,6 +648,7 @@ ngx_quic_free_buffer(ngx_connection_t *c, ngx_quic_buffer_t *qb)
     ngx_quic_free_chain(c, qb->chain);
 
     qb->chain = NULL;
+    qb->last_chain = NULL;
 }
 
 

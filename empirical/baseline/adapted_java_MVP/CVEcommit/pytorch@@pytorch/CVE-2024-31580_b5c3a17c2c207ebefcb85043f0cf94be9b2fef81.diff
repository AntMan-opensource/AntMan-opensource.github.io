commit b5c3a17c2c207ebefcb85043f0cf94be9b2fef81
Author: Octavian Guzu <octavguzu@fb.com>
Date:   Tue Oct 3 18:48:08 2023 +0000

    [fuzzing result][fuzz_torch_jit_lite_interpreter] read-heap-buffer-overflow-far-from-bounds (size 4) in c10::IValue::IValue() (#110441)
    
    Summary: This diff fixes a heap underflow found by fuzzing in torch/csrc/jit/runtime/vararg_functions.cpp
    
    Test Plan:
    CI and
    ```
    arc lionhead crash reproduce 1753074381791061
    ```
    doesn't crash anymore.
    
    Differential Revision: D49537535
    
    Pull Request resolved: https://github.com/pytorch/pytorch/pull/110441
    Approved by: https://github.com/Skylion007

diff --git a/torch/csrc/jit/runtime/vararg_functions.cpp b/torch/csrc/jit/runtime/vararg_functions.cpp
index 69e2c0fc17..bb28b61fe7 100644
--- a/torch/csrc/jit/runtime/vararg_functions.cpp
+++ b/torch/csrc/jit/runtime/vararg_functions.cpp
@@ -267,6 +267,9 @@ void listUnpack(Stack& stack, size_t num_outputs) {
 }
 
 void tupleConstruct(Stack& stack, size_t num_inputs) {
+  if (num_inputs > stack.size()) {
+    TORCH_CHECK(false, "Invalid number of inputs: ", num_inputs);
+  }
   switch (num_inputs) {
     case 0:
       stack.emplace_back(c10::ivalue::Tuple::create());

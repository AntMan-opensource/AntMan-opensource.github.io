commit f39fa0b59b4d693f1997bc0cbf8b3b0772018563
Author: Kaian <kaian@irontec.com>
Date:   Fri Mar 3 12:49:17 2023 +0100

    capture: validate frame has at least IP header before assembly #431

diff --git a/src/capture.c b/src/capture.c
index 0057063..ed67385 100644
--- a/src/capture.c
+++ b/src/capture.c
@@ -620,6 +620,15 @@ capture_packet_reasm_ip(capture_info_t *capinfo, const struct pcap_pkthdr *heade
     if (*caplen > MAX_CAPTURE_LEN)
         return NULL;
 
+    // Check frame has at least IP header length
+    if (ip_ver == 4 && header->caplen < link_hl + sizeof(struct ip))
+        return NULL;
+
+#ifdef USE_IPV6
+    if (ip_ver == 6 && header->caplen < link_hl + sizeof(struct ip6_hdr))
+        return NULL;
+#endif
+
     // If no fragmentation
     if (ip_frag == 0) {
         // Just create a new packet with given network data

commit b852ad701db21d6db5b34e66f4ec1cdccd2ec4d4
Author: Manos Koukoutos <manoskouk@chromium.org>
Date:   Thu Mar 21 11:38:08 2024 +0100

    [wasm] Check for type-definition count limit
    
    Bug: chromium:330575498
    Change-Id: I395f0ed6d823b7d1e139da6551486e3627d65724
    Reviewed-on: https://chromium-review.googlesource.com/c/v8/v8/+/5378419
    Commit-Queue: Jakob Kummerow <jkummerow@chromium.org>
    Reviewed-by: Jakob Kummerow <jkummerow@chromium.org>
    Auto-Submit: Manos Koukoutos <manoskouk@chromium.org>
    Cr-Commit-Position: refs/heads/main@{#92941}

diff --git a/src/wasm/module-decoder-impl.h b/src/wasm/module-decoder-impl.h
index 8f4902aa482..6b7064578db 100644
--- a/src/wasm/module-decoder-impl.h
+++ b/src/wasm/module-decoder-impl.h
@@ -661,6 +661,11 @@ class ModuleDecoderImpl : public Decoder {
         }
       } else {
         if (tracer_) tracer_->TypeOffset(pc_offset());
+        if (initial_size + 1 > kV8MaxWasmTypes) {
+          errorf(pc(), "Type definition count exceeds maximum %zu",
+                 kV8MaxWasmTypes);
+          return;
+        }
         // Similarly to above, we need to resize types for a group of size 1.
         module_->types.resize(initial_size + 1);
         module_->isorecursive_canonical_type_ids.resize(initial_size + 1);

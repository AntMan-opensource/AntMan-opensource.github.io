commit 401ca034cdb6cc418a461ce70ab28f92d83d51fb
Author: Mark Johnston <markj@FreeBSD.org>
Date:   Tue Feb 5 17:55:08 2019 +0000

    Avoid leaking fp references when truncating SCM_RIGHTS control messages.
    
    Reported by:    pho
    Approved by:    so
    MFC after:      0 minutes
    Security:       CVE-2019-5596
    Sponsored by:   The FreeBSD Foundation

diff --git a/sys/kern/uipc_syscalls.c b/sys/kern/uipc_syscalls.c
index b86f041c54ef..0f0c8888a147 100644
--- a/sys/kern/uipc_syscalls.c
+++ b/sys/kern/uipc_syscalls.c
@@ -1605,8 +1605,10 @@ m_dispose_extcontrolm(struct mbuf *m)
 					fd = *fds++;
 					error = fget(td, fd, &cap_no_rights,
 					    &fp);
-					if (error == 0)
+					if (error == 0) {
 						fdclose(td, fp, fd);
+						fdrop(fp, td);
+					}
 				}
 			}
 			clen -= datalen;

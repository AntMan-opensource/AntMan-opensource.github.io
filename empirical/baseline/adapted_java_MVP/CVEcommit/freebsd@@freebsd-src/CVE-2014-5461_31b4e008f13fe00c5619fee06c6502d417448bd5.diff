commit 31b4e008f13fe00c5619fee06c6502d417448bd5
Author: Richard Yao <richard.yao@alumni.stonybrook.edu>
Date:   Tue Sep 27 19:44:13 2022 -0400

    LUA: Fix CVE-2014-5461
    
    Apply the fix from upstream.
    
    http://www.lua.org/bugs.html#5.2.2-1
    https://www.opencve.io/cve/CVE-2014-5461
    
    It should be noted that exploiting this requires the `SYS_CONFIG`
    privilege, and anyone with that privilege likely has other opportunities
    to do exploits, so it is unlikely that bad actors could exploit this
    unless system administrators are executing untrusted ZFS Channel
    Programs.
    
    Reviewed-by: Brian Behlendorf <behlendorf1@llnl.gov>
    Signed-off-by: Richard Yao <richard.yao@alumni.stonybrook.edu>
    Closes #13949

diff --git a/module/lua/ldo.c b/module/lua/ldo.c
index b9368d9ceab6..24677596de12 100644
--- a/module/lua/ldo.c
+++ b/module/lua/ldo.c
@@ -405,7 +405,7 @@ int luaD_precall (lua_State *L, StkId func, int nresults) {
       StkId base;
       Proto *p = clLvalue(func)->p;
       n = cast_int(L->top - func) - 1;  /* number of real arguments */
-      luaD_checkstack(L, p->maxstacksize);
+      luaD_checkstack(L, p->maxstacksize + p->numparams);
       for (; n < p->numparams; n++)
         setnilvalue(L->top++);  /* complete missing arguments */
       if (!p->is_vararg) {

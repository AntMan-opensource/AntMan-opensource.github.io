commit 46701f31bec2f1ccb8768d0cda91b36f9ec9c5d8
Author: Ed Maste <emaste@FreeBSD.org>
Date:   Tue May 12 16:38:28 2020 +0000

    libalias: fix potential memory disclosure from ftp module
    
    admbugs:        956
    Submitted by:   markj
    Reported by:    Vishnu Dev TJ working with Trend Micro Zero Day Initiative
    Security:       FreeBSD-SA-20:13.libalias
    Security:       CVE-2020-7455
    Security:       ZDI-CAN-10849

diff --git a/sys/netinet/libalias/alias_ftp.c b/sys/netinet/libalias/alias_ftp.c
index ee93f4c5b14b..f8e0a703345d 100644
--- a/sys/netinet/libalias/alias_ftp.c
+++ b/sys/netinet/libalias/alias_ftp.c
@@ -754,7 +754,8 @@ NewFtpMessage(struct libalias *la, struct ip *pip,
 		{
 			u_short new_len;
 
-			new_len = htons(hlen + slen);
+			new_len = htons(hlen +
+			    MIN(slen, maxpacketsize - hlen));
 			DifferentialChecksum(&pip->ip_sum,
 			    &new_len,
 			    &pip->ip_len,

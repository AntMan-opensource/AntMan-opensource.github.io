commit 6ac6d35066dfcff6f7ec4933f9cad7fff7412ef5
Author: andy.padavan <andy.padavan@gmail.com>
Date:   Mon Jul 21 23:04:59 2014 +0800

    kernel-3.x.x: net/l2tp: don't fall back on UDP [get|set]sockopt, commit 3cf521f7dc87c031617fd47e4b7aa2593c2f3daf upstream (CVE-2014-4943)

diff --git a/trunk/linux-3.0.x/net/l2tp/l2tp_ppp.c b/trunk/linux-3.0.x/net/l2tp/l2tp_ppp.c
index 86da6d62d..b9901b934 100644
--- a/trunk/linux-3.0.x/net/l2tp/l2tp_ppp.c
+++ b/trunk/linux-3.0.x/net/l2tp/l2tp_ppp.c
@@ -1352,7 +1352,7 @@ static int pppol2tp_setsockopt(struct socket *sock, int level, int optname,
 	int err;
 
 	if (level != SOL_PPPOL2TP)
-		return udp_prot.setsockopt(sk, level, optname, optval, optlen);
+		return -EINVAL;
 
 	if (optlen < sizeof(int))
 		return -EINVAL;
@@ -1478,7 +1478,7 @@ static int pppol2tp_getsockopt(struct socket *sock, int level,
 	struct pppol2tp_session *ps;
 
 	if (level != SOL_PPPOL2TP)
-		return udp_prot.getsockopt(sk, level, optname, optval, optlen);
+		return -EINVAL;
 
 	if (get_user(len, (int __user *) optlen))
 		return -EFAULT;
diff --git a/trunk/linux-3.4.x/net/l2tp/l2tp_ppp.c b/trunk/linux-3.4.x/net/l2tp/l2tp_ppp.c
index 206a52726..701ce34ac 100644
--- a/trunk/linux-3.4.x/net/l2tp/l2tp_ppp.c
+++ b/trunk/linux-3.4.x/net/l2tp/l2tp_ppp.c
@@ -1352,7 +1352,7 @@ static int pppol2tp_setsockopt(struct socket *sock, int level, int optname,
 	int err;
 
 	if (level != SOL_PPPOL2TP)
-		return udp_prot.setsockopt(sk, level, optname, optval, optlen);
+		return -EINVAL;
 
 	if (optlen < sizeof(int))
 		return -EINVAL;
@@ -1478,7 +1478,7 @@ static int pppol2tp_getsockopt(struct socket *sock, int level,
 	struct pppol2tp_session *ps;
 
 	if (level != SOL_PPPOL2TP)
-		return udp_prot.getsockopt(sk, level, optname, optval, optlen);
+		return -EINVAL;
 
 	if (get_user(len, (int __user *) optlen))
 		return -EFAULT;

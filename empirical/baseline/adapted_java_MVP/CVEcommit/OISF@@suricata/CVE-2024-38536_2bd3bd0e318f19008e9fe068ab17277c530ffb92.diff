commit 2bd3bd0e318f19008e9fe068ab17277c530ffb92
Author: Philippe Antoine <pantoine@oisf.net>
Date:   Fri May 17 09:39:52 2024 +0200

    http: fix nul deref on memcap reached
    
    HttpRangeOpenFileAux may return NULL in different cases, including
    when memcap is reached.
    But is only caller did not check it before calling HttpRangeAppendData
    which would dereference the NULL value.
    
    Ticket: 7029
    (cherry picked from commit fd262df457f67f2174752dd6505ba2ed5911fd96)

diff --git a/src/app-layer-htp-range.c b/src/app-layer-htp-range.c
index 3cdde35ba..f0d75a975 100644
--- a/src/app-layer-htp-range.c
+++ b/src/app-layer-htp-range.c
@@ -351,8 +351,10 @@ static HttpRangeContainerBlock *HttpRangeOpenFile(HttpRangeContainerFile *c, uin
 {
     HttpRangeContainerBlock *r =
             HttpRangeOpenFileAux(c, start, end, total, sbcfg, name, name_len, flags);
-    if (HttpRangeAppendData(sbcfg, r, data, len) < 0) {
-        SCLogDebug("Failed to append data while opening");
+    if (r) {
+        if (HttpRangeAppendData(sbcfg, r, data, len) < 0) {
+            SCLogDebug("Failed to append data while opening");
+        }
     }
     return r;
 }

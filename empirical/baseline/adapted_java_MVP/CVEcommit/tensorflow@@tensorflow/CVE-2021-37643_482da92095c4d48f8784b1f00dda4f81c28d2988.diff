commit 482da92095c4d48f8784b1f00dda4f81c28d2988
Author: Laura Pak <lpak@google.com>
Date:   Mon Aug 2 15:07:31 2021 -0700

    Ensure non-empty padding_value input to tf.raw_ops.MatrixDiagPartV2, if a padding_value is input
    
    PiperOrigin-RevId: 388314614
    Change-Id: If0b51ad58d5d8543a6be6ce8f42ae4755c80d55f

diff --git a/tensorflow/core/kernels/linalg/matrix_diag_op.cc b/tensorflow/core/kernels/linalg/matrix_diag_op.cc
index b61dbe96a5d..1506df17121 100644
--- a/tensorflow/core/kernels/linalg/matrix_diag_op.cc
+++ b/tensorflow/core/kernels/linalg/matrix_diag_op.cc
@@ -89,7 +89,10 @@ class MatrixDiagPartOp : public OpKernel {
           upper_diag_index = diag_index.flat<int32>()(1);
         }
       }
-      padding_value = context->input(2).flat<T>()(0);
+      const Tensor& padding_in = context->input(2);
+      OP_REQUIRES(context, padding_in.NumElements() == 1,
+                  errors::InvalidArgument("Padding must be scalar."));
+      padding_value = padding_in.flat<T>()(0);
     }
     const TensorShape& input_shape = input.shape();
 

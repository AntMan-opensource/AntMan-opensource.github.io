commit 954d488a9798f8fda675c6b57c571b469b298f04
Author: Yoshifumi Hosoya <yoshifumi.hosoya.wj@renesas.com>
Date:   Sun Apr 23 21:11:15 2023 +0900

    rcar-gen3: plat: BL2: fix Incorrect Address Range Calculation
    
    Check against all address overlap cases
    
    Reviewed-by: Tomer Fichman <Tomer.Fichman@cymotive.com>
    Signed-off-by: Yoshifumi Hosoya <yoshifumi.hosoya.wj@renesas.com>

diff --git a/drivers/renesas/common/io/io_rcar.c b/drivers/renesas/common/io/io_rcar.c
index 9b29a5be8..21ed41113 100644
--- a/drivers/renesas/common/io/io_rcar.c
+++ b/drivers/renesas/common/io/io_rcar.c
@@ -335,13 +335,18 @@ done:
 		 * 2. check:
 		 *      | IMAGE n |
 		 *  | IMAGE n+1 |
+		 * 3. check:
+		 *      | IMAGE n |
+		 *  |    IMAGE n+1    |
 		 *
 		 * */
-		if (((dst > addr_loaded[n].dest) &&
-		     (dst <  addr_loaded[n].dest + addr_loaded[n].length)) ||
-		    (((dst < addr_loaded[n].dest) &&
-		      (dst + len)) > addr_loaded[n].dest)) {
-			ERROR("BL2: image is inside a previous image area.\n");
+		if (((dst >= addr_loaded[n].dest) &&
+		     (dst <=  addr_loaded[n].dest + addr_loaded[n].length)) ||
+		    ((dst + len >= addr_loaded[n].dest) &&
+		     (dst + len <= addr_loaded[n].dest + addr_loaded[n].length)) ||
+		    ((dst <= addr_loaded[n].dest) &&
+		     (dst + len >= addr_loaded[n].dest + addr_loaded[n].length))) {
+			ERROR("BL2: next image overlap a previous image area.\n");
 			result = IO_FAIL;
 		}
 	}

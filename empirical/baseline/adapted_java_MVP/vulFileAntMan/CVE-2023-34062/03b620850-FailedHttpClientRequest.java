package reactor.netty.http.client;
import io.netty.handler.codec.http.HttpHeaderNames;
import io.netty.handler.codec.http.HttpHeaderValues;
import io.netty.handler.codec.http.HttpHeaders;
import io.netty.handler.codec.http.HttpMethod;
import io.netty.handler.codec.http.HttpVersion;
import io.netty.handler.codec.http.cookie.ClientCookieDecoder;
import io.netty.handler.codec.http.cookie.Cookie;
import reactor.netty.http.Cookies;
import reactor.netty.http.HttpOperations;
import reactor.util.context.Context;
import reactor.util.context.ContextView;
import java.time.Duration;
import java.util.Map;
import java.util.Set;
final class FailedHttpClientRequest implements HttpClientRequest {
	final ContextView         contextView;
	final ClientCookieDecoder cookieDecoder;
	final HttpHeaders         headers;
	final boolean             isWebsocket;
	final HttpMethod          method;
	final String              path;
	final Duration            responseTimeout;
	final String              uri;
	FailedHttpClientRequest(ContextView contextView, HttpClientConfig c) {
		this.contextView = contextView;
		this.cookieDecoder = c.cookieDecoder;
		this.headers = c.headers;
		this.isWebsocket = c.websocketClientSpec != null;
		this.method = c.method;
		this.uri = c.uri == null ? c.uriStr : c.uri.toString();
		this.path = this.uri != null ? HttpOperations.resolvePath(this.uri) : null;
		this.responseTimeout = c.responseTimeout;
	}
	
	public HttpClientRequest addCookie(Cookie cookie) {
		throw new UnsupportedOperationException("Should not add Cookie");
	}
	
	public HttpClientRequest addHeader(CharSequence name, CharSequence value) {
		throw new UnsupportedOperationException("Should not add Header");
	}
	
	public Map<CharSequence, Set<Cookie>> cookies() {
		return Cookies.newClientResponseHolder(headers, cookieDecoder) .getCachedCookies();
	}
	
	public Context currentContext() {
		return Context.of(contextView);
	}
	
	public ContextView currentContextView() {
		return contextView;
	}
	
	public String fullPath() {
		return path;
	}
	
	public String requestId() {
		return "";
	}
	
	public HttpClientRequest header(CharSequence name, CharSequence value) {
		throw new UnsupportedOperationException("Should not add Header");
	}
	
	public HttpClientRequest headers(HttpHeaders headers) {
		throw new UnsupportedOperationException("Should not add Header");
	}
	
	public boolean isFollowRedirect() {
		return true;
	}
	
	public boolean isKeepAlive() {
		return HttpHeaderValues.CLOSE.contentEqualsIgnoreCase(headers.get(HttpHeaderNames.CONNECTION));
	}
	
	public boolean isWebsocket() {
		return isWebsocket;
	}
	
	public HttpMethod method() {
		return method;
	}
	
	public String[] redirectedFrom() { 		return EMPTY;
	}
	
	public HttpHeaders requestHeaders() {
		return headers;
	}
	
	public HttpClientRequest responseTimeout(Duration maxReadOperationInterval) {
		throw new UnsupportedOperationException("Should not add response timeout");
	}
	
	public String resourceUrl() {
		return null;
	}
	
	public String uri() {
		return uri;
	}
	
	public HttpVersion version() {
		return HttpVersion.HTTP_1_1;
	}
	
	final static String[] EMPTY = new String[0];
}



package com.hccake.ballcat.codegen.engine;
import com.hccake.ballcat.codegen.exception.TemplateRenderException;
import org.apache.velocity.VelocityContext;
import org.apache.velocity.app.Velocity;
import org.apache.velocity.runtime.resource.loader.ClasspathResourceLoader;
import org.springframework.stereotype.Component;
import java.io.StringWriter;
import java.util.Map;
import java.util.Properties;
public class VelocityTemplateEngine implements TemplateEngine {
	static {
		 Properties prop = new Properties();
		prop.put("file.resource.loader.class", ClasspathResourceLoader.class.getName());
		Velocity.init(prop);
	}
	
	public TemplateEngineTypeEnum type() {
		return TemplateEngineTypeEnum.VELOCITY;
	}
	
	public String render(String templateContent, Map<String, Object> context) {
		VelocityContext velocityContext = new VelocityContext(context);
		try (StringWriter sw = new StringWriter()) {
			Velocity.evaluate(velocityContext, sw, "velocityTemplateEngine", templateContent);
			return sw.toString();
		}
		
		catch (Exception ex) {
			throw new TemplateRenderException(ex);
		}
		
	}
	
}



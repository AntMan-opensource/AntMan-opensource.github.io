





































































UINT _ux_device_class_ccid_icc_remove(UX_DEVICE_CLASS_CCID *ccid, ULONG slot)
{

UX_DEVICE_CLASS_CCID_SLOT       *ccid_slot;

    
    if (slot >= ccid -> ux_device_class_ccid_parameter.ux_device_class_ccid_max_n_slots)
        return(UX_INVALID_PARAMETER);

    
    ccid_slot  = ccid -> ux_device_class_ccid_slots;
    ccid_slot += slot;

    
    _ux_device_class_ccid_lock(ccid);

    
    if (ccid_slot -> ux_device_class_ccid_slot_icc_status == UX_DEVICE_CLASS_CCID_ICC_NOT_PRESENT)
    {
        _ux_device_class_ccid_unlock(ccid);
        return(UX_SUCCESS);
    }

    
    ccid_slot -> ux_device_class_ccid_slot_icc_status = UX_DEVICE_CLASS_CCID_SLOT_STATUS_ICC_NOT_PRESENT;

    
    ccid_slot -> ux_device_class_ccid_slot_flags &= (UCHAR)~UX_DEVICE_CLASS_CCID_FLAG_AUTO_SEQUENCING;

    
    ccid_slot -> ux_device_class_ccid_slot_hw_error = 0;
    ccid_slot -> ux_device_class_ccid_slot_flags &= (UCHAR)~UX_DEVICE_CLASS_CCID_FLAG_HW_ERROR;

    
    if (ccid -> ux_device_class_ccid_endpoint_notify)
    {
        ccid_slot -> ux_device_class_ccid_slot_flags |= UX_DEVICE_CLASS_CCID_FLAG_NOTIFY_CHANGE;
        _ux_device_class_ccid_unlock(ccid);
        _ux_device_semaphore_put(&ccid -> ux_device_class_ccid_notify_semaphore);


        if (ccid -> ux_device_class_ccid_notify_state == UX_DEVICE_CLASS_CCID_NOTIFY_IDLE)
            ccid -> ux_device_class_ccid_notify_state = UX_DEVICE_CLASS_CCID_NOTIFY_LOCK;

        return(UX_SUCCESS);
    }
    _ux_device_class_ccid_unlock(ccid);

    
    return(UX_SUCCESS);
}

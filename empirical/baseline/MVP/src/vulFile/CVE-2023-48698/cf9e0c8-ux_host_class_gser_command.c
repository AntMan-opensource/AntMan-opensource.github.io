













 
 
















 
 
 
 
 






 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 
 

 
 
 
 
 
 
 
 
 








UINT  _ux_host_class_gser_command(UX_HOST_CLASS_GSER *gser, ULONG interface_index, ULONG command, ULONG value, UCHAR *data_buffer, ULONG data_length)
{

UX_ENDPOINT     *control_endpoint;
UX_TRANSFER     *transfer_request;
UINT            status;
ULONG           request_direction;

    
    
    control_endpoint =  &gser -> ux_host_class_gser_device -> ux_device_control_endpoint;
    transfer_request =  &control_endpoint -> ux_endpoint_transfer_request;

    
    switch (command)
    {
    
        case UX_HOST_CLASS_GSER_REQ_SEND_ENCAPSULATED_COMMAND        :
        case UX_HOST_CLASS_GSER_REQ_SET_COMM_FEATURE                 :
        case UX_HOST_CLASS_GSER_REQ_CLEAR_COMM_FEATURE               :
        case UX_HOST_CLASS_GSER_REQ_SET_AUX_LINE_STATE               :
        case UX_HOST_CLASS_GSER_REQ_SET_HOOK_STATE                   :
        case UX_HOST_CLASS_GSER_REQ_PULSE_SETUP                      :
        case UX_HOST_CLASS_GSER_REQ_SEND_PULSE                       :
        case UX_HOST_CLASS_GSER_REQ_SET_PUSLE_TIME                   :
        case UX_HOST_CLASS_GSER_REQ_RING_AUX_JACK                    :
        case UX_HOST_CLASS_GSER_REQ_SET_LINE_CODING                  :
        case UX_HOST_CLASS_GSER_REQ_SET_LINE_STATE                   :
        case UX_HOST_CLASS_GSER_REQ_SEND_BREAK                       :
        case UX_HOST_CLASS_GSER_REQ_SET_RINGER_PARMS                 :
        case UX_HOST_CLASS_GSER_REQ_SET_OPERATION_PARMS              :
        case UX_HOST_CLASS_GSER_REQ_SET_LINE_PARMS                   :
    
            
            request_direction = UX_REQUEST_OUT;
            break;


        case UX_HOST_CLASS_GSER_REQ_GET_ENCAPSULATED_COMMAND         :
        case UX_HOST_CLASS_GSER_REQ_GET_COMM_FEATURE                 :
        case UX_HOST_CLASS_GSER_REQ_GET_LINE_CODING                  :
        case UX_HOST_CLASS_GSER_REQ_GET_RINGER_PARMS                 :
        case UX_HOST_CLASS_GSER_REQ_GET_OPERATION_PARMS              :
        case UX_HOST_CLASS_GSER_REQ_GET_LINE_PARMS                   :

            
            request_direction = UX_REQUEST_IN;
            break;


        default :
        
            return(UX_ERROR);

    }

    
    status =  _ux_host_semaphore_get(&gser -> ux_host_class_gser_device -> ux_device_protection_semaphore, UX_WAIT_FOREVER);

    
    if (status != UX_SUCCESS)
    
        
        return(status);
        
    
    transfer_request -> ux_transfer_request_data_pointer     =  data_buffer;
    transfer_request -> ux_transfer_request_requested_length =  data_length;
    transfer_request -> ux_transfer_request_function         =  command;
    transfer_request -> ux_transfer_request_type             =  request_direction | UX_REQUEST_TYPE_CLASS | UX_REQUEST_TARGET_INTERFACE;
    transfer_request -> ux_transfer_request_value            =  value;
    transfer_request -> ux_transfer_request_index            =  gser -> ux_host_class_gser_interface_array[interface_index].ux_host_class_gser_interface->ux_interface_descriptor.bInterfaceNumber;

    
    status =  _ux_host_stack_transfer_request(transfer_request);

    
    return(status);
}


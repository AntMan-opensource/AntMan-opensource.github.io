

















const char* GUAC_VNC_CLIENT_ARGS[] = {
    "hostname", "port", "read-only", "encodings", GUAC_VNC_ARGV_USERNAME, GUAC_VNC_ARGV_PASSWORD, "swap-red-blue", "color-depth", "cursor", "autoretry", "clipboard-encoding",   "dest-host", "dest-port",    "enable-audio", "audio-servername",    "reverse-connect", "listen-timeout",    "enable-sftp", "sftp-hostname", "sftp-host-key", "sftp-port", "sftp-username", "sftp-password", "sftp-private-key", "sftp-passphrase", "sftp-directory", "sftp-root-directory", "sftp-server-alive-interval", "sftp-disable-download", "sftp-disable-upload",   "recording-path", "recording-name", "recording-exclude-output", "recording-exclude-mouse", "recording-include-keys", "create-recording-path", "disable-copy", "disable-paste",  "wol-send-packet", "wol-mac-addr", "wol-broadcast-addr", "wol-udp-port", "wol-wait-time",  "force-lossless", NULL };




























































enum VNC_ARGS_IDX {
    
    
    IDX_HOSTNAME,   IDX_PORT,   IDX_READ_ONLY,   IDX_ENCODINGS,   IDX_USERNAME,   IDX_PASSWORD,   IDX_SWAP_RED_BLUE,   IDX_COLOR_DEPTH,   IDX_CURSOR,   IDX_AUTORETRY,   IDX_CLIPBOARD_ENCODING,    IDX_DEST_HOST,   IDX_DEST_PORT,     IDX_ENABLE_AUDIO,   IDX_AUDIO_SERVERNAME,     IDX_REVERSE_CONNECT,   IDX_LISTEN_TIMEOUT,     IDX_ENABLE_SFTP,   IDX_SFTP_HOSTNAME,   IDX_SFTP_HOST_KEY,   IDX_SFTP_PORT,   IDX_SFTP_USERNAME,   IDX_SFTP_PASSWORD,   IDX_SFTP_PRIVATE_KEY,   IDX_SFTP_PASSPHRASE,   IDX_SFTP_DIRECTORY,   IDX_SFTP_ROOT_DIRECTORY,   IDX_SFTP_SERVER_ALIVE_INTERVAL,   IDX_SFTP_DISABLE_DOWNLOAD,   IDX_SFTP_DISABLE_UPLOAD,    IDX_RECORDING_PATH,   IDX_RECORDING_NAME,   IDX_RECORDING_EXCLUDE_OUTPUT,   IDX_RECORDING_EXCLUDE_MOUSE,   IDX_RECORDING_INCLUDE_KEYS,   IDX_CREATE_RECORDING_PATH,   IDX_DISABLE_COPY,   IDX_DISABLE_PASTE,   IDX_WOL_SEND_PACKET,   IDX_WOL_MAC_ADDR,   IDX_WOL_BROADCAST_ADDR,   IDX_WOL_UDP_PORT,   IDX_WOL_WAIT_TIME,   IDX_FORCE_LOSSLESS,  VNC_ARGS_COUNT };












































































































































guac_vnc_settings* guac_vnc_parse_args(guac_user* user, int argc, const char** argv) {

    
    if (argc != VNC_ARGS_COUNT) {
        guac_user_log(user, GUAC_LOG_WARNING, "Incorrect number of connection " "parameters provided: expected %i, got %i.", VNC_ARGS_COUNT, argc);

        return NULL;
    }

    guac_vnc_settings* settings = calloc(1, sizeof(guac_vnc_settings));

    settings->hostname = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_HOSTNAME, "");


    settings->port = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_PORT, 0);


    settings->username = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_USERNAME, NULL);

    
    settings->password = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_PASSWORD, NULL);

    
    
    if (strcmp(argv[IDX_CURSOR], "remote") == 0) {
        guac_user_log(user, GUAC_LOG_INFO, "Cursor rendering: remote");
        settings->remote_cursor = true;
    }

    
    else {
        guac_user_log(user, GUAC_LOG_INFO, "Cursor rendering: local");
        settings->remote_cursor = false;
    }

    
    settings->swap_red_blue = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SWAP_RED_BLUE, false);


    
    settings->read_only = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_READ_ONLY, false);


    
    settings->color_depth = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_COLOR_DEPTH, 0);


    
    settings->lossless = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_FORCE_LOSSLESS, false);



    
    settings->dest_host = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_DEST_HOST, NULL);


    
    settings->dest_port = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_DEST_PORT, 0);



    
    settings->encodings = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_ENCODINGS, "zrle ultra copyrect hextile zlib corre rre raw");



    
    settings->retries = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_AUTORETRY, 0);



    
    settings->reverse_connect = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_REVERSE_CONNECT, false);


    
    settings->listen_timeout = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_LISTEN_TIMEOUT, 5000);




    
    settings->audio_enabled = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_ENABLE_AUDIO, false);


    
    if (settings->audio_enabled)
        settings->pa_servername = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_AUDIO_SERVERNAME, NULL);



    
    settings->clipboard_encoding = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_CLIPBOARD_ENCODING, NULL);



    
    settings->enable_sftp = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_ENABLE_SFTP, false);


    
    settings->sftp_hostname = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_HOSTNAME, settings->hostname);


    
    settings->sftp_host_key = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_HOST_KEY, NULL);


    
    settings->sftp_port = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_PORT, "22");


    
    settings->sftp_username = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_USERNAME, "");


    
    settings->sftp_password = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_PASSWORD, "");


    
    settings->sftp_private_key = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_PRIVATE_KEY, NULL);


    
    settings->sftp_passphrase = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_PASSPHRASE, "");


    
    settings->sftp_directory = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_DIRECTORY, NULL);


    
    settings->sftp_root_directory = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_ROOT_DIRECTORY, "/");


    
    settings->sftp_server_alive_interval = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_SERVER_ALIVE_INTERVAL, 0);

    
    settings->sftp_disable_download = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_DISABLE_DOWNLOAD, false);

    
    settings->sftp_disable_upload = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_SFTP_DISABLE_UPLOAD, false);



    
    settings->recording_path = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_RECORDING_PATH, NULL);


    
    settings->recording_name = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_RECORDING_NAME, GUAC_VNC_DEFAULT_RECORDING_NAME);


    
    settings->recording_exclude_output = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_RECORDING_EXCLUDE_OUTPUT, false);


    
    settings->recording_exclude_mouse = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_RECORDING_EXCLUDE_MOUSE, false);


    
    settings->recording_include_keys = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_RECORDING_INCLUDE_KEYS, false);


    
    settings->create_recording_path = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_CREATE_RECORDING_PATH, false);


    
    settings->disable_copy = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_DISABLE_COPY, false);


    
    settings->disable_paste = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_DISABLE_PASTE, false);

    
    
    settings->wol_send_packet = guac_user_parse_args_boolean(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_WOL_SEND_PACKET, false);

    
    if (settings->wol_send_packet) {
        
        
        if(strcmp(argv[IDX_WOL_MAC_ADDR], "") == 0) {
            guac_user_log(user, GUAC_LOG_WARNING, "Wake on LAN was requested, ", "but no MAC address was specified.  WoL will not be sent.");
            settings->wol_send_packet = false;
        }
        
        
        settings->wol_mac_addr = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_WOL_MAC_ADDR, NULL);

        
        
        settings->wol_broadcast_addr = guac_user_parse_args_string(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_WOL_BROADCAST_ADDR, GUAC_WOL_LOCAL_IPV4_BROADCAST);

        
        
        settings->wol_udp_port = (unsigned short)
            guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_WOL_UDP_PORT, GUAC_WOL_PORT);
        
        
        settings->wol_wait_time = guac_user_parse_args_int(user, GUAC_VNC_CLIENT_ARGS, argv, IDX_WOL_WAIT_TIME, GUAC_WOL_DEFAULT_BOOT_WAIT_TIME);

        
    }

    return settings;

}

void guac_vnc_settings_free(guac_vnc_settings* settings) {

    
    free(settings->clipboard_encoding);
    free(settings->encodings);
    free(settings->hostname);
    free(settings->password);
    free(settings->recording_name);
    free(settings->recording_path);
    free(settings->username);


    
    free(settings->dest_host);



    
    free(settings->sftp_directory);
    free(settings->sftp_root_directory);
    free(settings->sftp_host_key);
    free(settings->sftp_hostname);
    free(settings->sftp_passphrase);
    free(settings->sftp_password);
    free(settings->sftp_port);
    free(settings->sftp_private_key);
    free(settings->sftp_username);



    
    free(settings->pa_servername);

    
    
    free(settings->wol_mac_addr);
    free(settings->wol_broadcast_addr);

    
    free(settings);

}


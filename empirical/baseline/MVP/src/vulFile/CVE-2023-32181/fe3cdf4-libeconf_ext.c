








static char *ltrim(char *s)
{
  while(isspace(*s)) s++;
  return s;
}

static char *rtrim(char *s)
{
  if (strlen(s)<=0)
    return s;

  char* back = s + strlen(s);
  while(isspace(*--back));
  *(back+1) = '\0';
  return s;
}

static char *trim(char *s)
{
  return rtrim(ltrim(s));
}

econf_err econf_getExtValue(econf_file *kf, const char *group, const char *key, econf_ext_value **result)

{
  if (!kf)
    return ECONF_ERROR;

  size_t num;
  econf_err error = find_key(*kf, group, key, &num);
  if (error)
    return error;

  *result = malloc(sizeof(econf_ext_value));
  if (*result==NULL)
    return ECONF_NOMEM;

  getCommentsNum(*kf, num, &((*result)->comment_before_key), &((*result)->comment_after_value));

  getPath(*kf, &((*result)->file));
  getLineNrNum(*kf, num, &((*result)->line_number));

  char *value_string = NULL;
  getStringValueNum(*kf, num, &value_string);

  char buf[BUFSIZ];
  char *line;
  size_t n_del = 0;

  (*result)->values = NULL;

  if (value_string!=NULL) {
    strncpy(buf,value_string,BUFSIZ-1);
    free(value_string);
    value_string = trim(buf);

    if (value_string[0] == '\"')
    {
      
      (*result)->values = realloc ((*result)->values, sizeof (char*) * ++n_del);
      if ((*result)->values == NULL)
        return ECONF_NOMEM; 
      (*result)->values[n_del-1] = strdup(value_string);
    } else {
      
      while ((line = strsep(&value_string, "\n")) != NULL) {
        (*result)->values = realloc ((*result)->values, sizeof (char*) * ++n_del);
        if ((*result)->values == NULL)
          return ECONF_NOMEM; 
        (*result)->values[n_del-1] = strdup(trim(line));
      }
    }
  }

  
  (*result)->values = realloc ((*result)->values, sizeof (char*) * ++n_del);
  (*result)->values[n_del-1] = 0;

  return ECONF_SUCCESS;
}

extern void econf_freeExtValue(econf_ext_value *to_free)
{
  if (!to_free) { return; }

  
  char **str = to_free->values;
  while (*str)
    free(*str++); 
  free(to_free->values);

  free(to_free->file);
  free(to_free->comment_before_key);
  free(to_free->comment_after_value);
  free(to_free);
}

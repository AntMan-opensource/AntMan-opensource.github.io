































static lsquic_stream_ctx_t * hsk_server_on_new_stream (void *stream_if_ctx, lsquic_stream_t *stream)
{
    struct server_hsk_ctx *const s_hsk = stream_if_ctx;
    LSQ_DEBUG("stream created");

    lsquic_stream_wantread(stream, 1);

    
    return (lsquic_stream_ctx_t *) s_hsk;
}


static void hsk_server_on_read (lsquic_stream_t *stream, struct lsquic_stream_ctx *ctx)
{
    struct server_hsk_ctx *const s_hsk = (struct server_hsk_ctx *) ctx;
    struct lsquic_mm *const mm = &s_hsk->enpub->enp_mm;
    ssize_t nread;
    unsigned char *buf;

    buf = lsquic_mm_get_4k(mm);
    if (!buf)
    {
        LSQ_WARN("could not allocate buffer: %s", strerror(errno));
        return;
    }
    nread = lsquic_stream_read(stream, buf, 4 * 1024);
    lsquic_mm_put_4k(mm, buf);

    if (!(s_hsk->flags & SHC_WARNED))
    {
        LSQ_WARN("read %zd bytes from stream: what are we to do with them?  " "Further warnings suppressed", nread);
        s_hsk->flags |= SHC_WARNED;
    }
    else LSQ_DEBUG("read %zd bytes from stream", nread);
}


static void hsk_server_on_write (lsquic_stream_t *stream, struct lsquic_stream_ctx *ctx)
{
    assert(0);      
}


static void hsk_server_on_close (lsquic_stream_t *stream, struct lsquic_stream_ctx *ctx)
{
    struct server_hsk_ctx *s_hsk = (struct server_hsk_ctx *) ctx;
    LSQ_DEBUG("stream closed");
}


const struct lsquic_stream_if lsquic_server_hsk_stream_if = {
    .on_new_stream = hsk_server_on_new_stream, .on_read       = hsk_server_on_read, .on_write      = hsk_server_on_write, .on_close      = hsk_server_on_close, };




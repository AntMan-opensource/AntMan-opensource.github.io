






struct lsquic_packet_out;


struct bandwidth {
    uint64_t            value;  
};










struct bw_sampler {
    struct lsquic_conn *bws_conn;
    uint64_t            bws_total_sent, bws_total_acked, bws_total_lost;

    
    uint64_t            bws_last_acked_total_sent;
    
    lsquic_time_t       bws_last_acked_sent_time;
    lsquic_time_t       bws_last_acked_packet_time;
    lsquic_packno_t     bws_last_sent_packno;
    lsquic_packno_t     bws_end_of_app_limited_phase;
    struct malo        *bws_malo;   
    enum quic_ft_bit    bws_retx_frames;
    enum {
        BWS_CONN_ABORTED    = 1 << 0, BWS_WARNED          = 1 << 1, BWS_APP_LIMITED     = 1 << 2, }                   bws_flags;


};

struct bw_sample {
    TAILQ_ENTRY(bw_sample)      next;
    struct bandwidth            bandwidth;
    lsquic_time_t               rtt;
    int                         is_app_limited;
};

int lsquic_bw_sampler_init (struct bw_sampler *, struct lsquic_conn *, enum quic_ft_bit);


void lsquic_bw_sampler_packet_sent (struct bw_sampler *, struct lsquic_packet_out *, uint64_t in_flight);



struct bw_sample * lsquic_bw_sampler_packet_acked (struct bw_sampler *, struct lsquic_packet_out *, lsquic_time_t ack_time);


void lsquic_bw_sampler_packet_lost (struct bw_sampler *, struct lsquic_packet_out *);

void lsquic_bw_sampler_app_limited (struct bw_sampler *);

void lsquic_bw_sampler_cleanup (struct bw_sampler *);

unsigned lsquic_bw_sampler_entry_count (const struct bw_sampler *);




struct bwps_send_state {
    uint64_t    total_bytes_sent, total_bytes_acked, total_bytes_lost;

    int         is_app_limited;
};

struct bwp_state     {
    struct bwps_send_state      bwps_send_state;
    uint64_t                    bwps_sent_at_last_ack;
    lsquic_time_t               bwps_last_ack_sent_time;
    lsquic_time_t               bwps_last_ack_ack_time;
    unsigned short              bwps_packet_size;
};



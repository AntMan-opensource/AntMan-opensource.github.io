






struct lsquic_packet_in;
struct lsquic_cid;


struct data_frame {
    const unsigned char *df_data;       
    uint64_t             df_offset;     
    uint16_t             df_read_off;   
    uint16_t             df_size;       
    signed char          df_fin;        
};


typedef struct stream_frame {
    
    TAILQ_ENTRY(stream_frame)       next_frame;

    
    struct lsquic_packet_in        *packet_in;

    struct data_frame               data_frame;

    lsquic_stream_id_t stream_id;     
} stream_frame_t;









typedef struct lsquic_packet_in {
    TAILQ_ENTRY(lsquic_packet_in)   pi_next;
    lsquic_time_t                   pi_received;   
    lsquic_cid_t                    pi_dcid;

    lsquic_packno_t                 pi_packno;
    enum quic_ft_bit                pi_frame_types;
    unsigned short                  pi_header_sz;  
    unsigned short                  pi_data_sz;    
    
    unsigned short                  pi_refcnt;
    unsigned short                  pi_hsk_stream; 
    enum {
        PI_DECRYPTED    = (1 << 0), PI_OWN_DATA     = (1 << 1), PI_CONN_ID      = (1 << 2), PI_HSK_STREAM   = (1 << 3), PI_FROM_MINI    = (1 << 4),  PI_ENC_LEV_BIT_0= (1 << 5), PI_ENC_LEV_BIT_1= (1 << 6), PI_GQUIC        = (1 << 7), PI_UNUSED_8     = (1 << 8),  PI_ECN_BIT_0    = (1 << 9), PI_ECN_BIT_1    = (1 <<10),  PI_SPIN_BIT     = (1 <<11),  PI_BITS_BIT_0   = (1 <<12), PI_BITS_BIT_1   = (1 <<13),  PI_LOG_QL_BITS  = (1 <<14), PI_SQUARE_BIT   = (1 <<15), PI_LOSS_BIT     = (1 <<16), }                               pi_flags;





















    
    unsigned short                  pi_token_size; 
    unsigned char                   pi_token;      
    
    unsigned char                   pi_odcid;      
    unsigned char                   pi_odcid_len;  
    unsigned char                   pi_scid_off;   
    unsigned char                   pi_scid_len;   
    unsigned char                   pi_quic_ver;   
    unsigned char                   pi_nonce;      
    enum header_type                pi_header_type:8;
    unsigned char                   pi_path_id;
    
    unsigned char                  *pi_data;
} lsquic_packet_in_t;































struct ver_iter {
    const struct lsquic_packet_in  *packet_in;
    unsigned                        off;
};

int lsquic_packet_in_ver_first (const lsquic_packet_in_t *packet_in, struct ver_iter *, lsquic_ver_tag_t *ver_tag);


int lsquic_packet_in_ver_next (struct ver_iter *, lsquic_ver_tag_t *ver_tag);

size_t lsquic_packet_in_mem_used (const struct lsquic_packet_in *);

void lsquic_scid_from_packet_in (const struct lsquic_packet_in *, struct lsquic_cid *);




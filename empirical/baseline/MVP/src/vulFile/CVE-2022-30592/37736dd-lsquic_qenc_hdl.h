





struct lsquic_conn;
struct lsquic_stream;
struct lsquic_stream_if;
struct qpack_exp_record;

struct qpack_enc_hdl {
    struct lsquic_conn      *qeh_conn;
    enum {
        QEH_INITIALIZED     = 1 << 0, QEH_HAVE_SETTINGS   = 1 << 1, }                        qeh_flags;

    unsigned                 qeh_max_prefix_size;
    struct lsqpack_enc       qeh_encoder;
    struct lsquic_stream    *qeh_enc_sm_out;
    struct frab_list         qeh_fral;
    struct lsquic_stream    *qeh_dec_sm_in;
    struct qpack_exp_record *qeh_exp_rec;
    size_t                   qeh_tsu_sz;
    unsigned char            qeh_tsu_buf[LSQPACK_LONGEST_SDTC];
};

void lsquic_qeh_init (struct qpack_enc_hdl *, struct lsquic_conn *);

int lsquic_qeh_settings (struct qpack_enc_hdl *, unsigned max_table_size, unsigned dyn_table_size, unsigned max_risked_streams, int server);


void lsquic_qeh_cleanup (struct qpack_enc_hdl *);



enum qwh_status {
    QWH_FULL,    QWH_PARTIAL, QWH_ENOBUF, QWH_ERR, };




enum qwh_status lsquic_qeh_write_headers (struct qpack_enc_hdl *, lsquic_stream_id_t stream_id, unsigned seqno, const struct lsquic_http_headers *, unsigned char *buf, size_t *prefix_sz, size_t *headers_sz, uint64_t *completion_offset, enum lsqpack_enc_header_flags *hflags);




uint64_t lsquic_qeh_enc_off (struct qpack_enc_hdl *);

size_t lsquic_qeh_write_avail (struct qpack_enc_hdl *);

size_t lsquic_qeh_max_prefix_size (const struct qpack_enc_hdl *);

extern const struct lsquic_stream_if *const lsquic_qeh_enc_sm_out_if;
extern const struct lsquic_stream_if *const lsquic_qeh_dec_sm_in_if;



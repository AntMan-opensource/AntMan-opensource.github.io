













 
 
















 
 
 
 
 






 
 



 
 
 
 
 
 
 
 
 
 
 
 
 
 


 
 
 
 
 
 
 
 
 
 





















UINT  _ux_host_class_audio_read(UX_HOST_CLASS_AUDIO *audio, UX_HOST_CLASS_AUDIO_TRANSFER_REQUEST *audio_transfer_request)
{

UINT        status;
ULONG       mps;

    
    UX_TRACE_IN_LINE_INSERT(UX_TRACE_HOST_CLASS_AUDIO_READ, audio, audio_transfer_request -> ux_host_class_audio_transfer_request_data_pointer,  audio_transfer_request -> ux_host_class_audio_transfer_request_requested_length, 0, UX_TRACE_HOST_CLASS_EVENTS, 0, 0)

    
    if (_ux_host_stack_class_instance_verify(_ux_system_host_class_audio_name, (VOID *) audio) != UX_SUCCESS)
    {        

        
        _ux_system_error_handler(UX_SYSTEM_LEVEL_THREAD, UX_SYSTEM_CONTEXT_CLASS, UX_HOST_CLASS_INSTANCE_UNKNOWN);

        
        UX_TRACE_IN_LINE_INSERT(UX_TRACE_ERROR, UX_HOST_CLASS_INSTANCE_UNKNOWN, audio, 0, 0, UX_TRACE_ERRORS, 0, 0)

        return(UX_HOST_CLASS_INSTANCE_UNKNOWN);
    }

    
    _ux_host_mutex_on(&audio -> ux_host_class_audio_mutex);

    
    if (audio -> ux_host_class_audio_isochronous_endpoint -> ux_endpoint_descriptor.wMaxPacketSize == 0)
    {

        
        _ux_host_mutex_off(&audio -> ux_host_class_audio_mutex);

        
        _ux_system_error_handler(UX_SYSTEM_LEVEL_THREAD, UX_SYSTEM_CONTEXT_CLASS, UX_HOST_CLASS_AUDIO_WRONG_INTERFACE);

        
        return(UX_HOST_CLASS_AUDIO_WRONG_INTERFACE);
    }

    
    mps = _ux_host_class_audio_max_packet_size_get(audio);
    audio_transfer_request -> ux_host_class_audio_transfer_request_packet_size = mps;
    audio_transfer_request -> ux_host_class_audio_transfer_request_requested_length = mps;

    
    status =  _ux_host_class_audio_transfer_request(audio, audio_transfer_request);

    
    _ux_host_mutex_off(&audio -> ux_host_class_audio_mutex);

    
    return(status);
}

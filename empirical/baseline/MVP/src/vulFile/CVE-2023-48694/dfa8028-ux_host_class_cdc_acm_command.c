





















































































UINT  _ux_host_class_cdc_acm_command(UX_HOST_CLASS_CDC_ACM *cdc_acm, ULONG command, ULONG value, UCHAR *data_buffer, ULONG data_length)
{


UX_INTERRUPT_SAVE_AREA UX_DEVICE       *device;


UX_ENDPOINT     *control_endpoint;
UX_TRANSFER     *transfer_request;
UINT            status;
ULONG           request_direction;


    
    control_endpoint =  &cdc_acm -> ux_host_class_cdc_acm_device -> ux_device_control_endpoint;
    transfer_request =  &control_endpoint -> ux_endpoint_transfer_request;

    
    switch (command)
    {

    case UX_HOST_CLASS_CDC_ACM_REQ_SEND_ENCAPSULATED_COMMAND        :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_COMM_FEATURE                 :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_CLEAR_COMM_FEATURE               :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_AUX_LINE_STATE               :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_HOOK_STATE                   :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_PULSE_SETUP                      :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SEND_PULSE                       :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_PUSLE_TIME                   :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_RING_AUX_JACK                    :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_LINE_CODING                  :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_LINE_STATE                   :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SEND_BREAK                       :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_RINGER_PARMS                 :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_OPERATION_PARMS              :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_SET_LINE_PARMS                   :

        
        request_direction = UX_REQUEST_OUT;
        break;


    case UX_HOST_CLASS_CDC_ACM_REQ_GET_ENCAPSULATED_COMMAND         :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_GET_COMM_FEATURE                 :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_GET_LINE_CODING                  :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_GET_RINGER_PARMS                 :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_GET_OPERATION_PARMS              :
    
    case UX_HOST_CLASS_CDC_ACM_REQ_GET_LINE_PARMS                   :

        
        request_direction = UX_REQUEST_IN;
        break;


    default :

        return(UX_ERROR);

    }



    
    device = cdc_acm -> ux_host_class_cdc_acm_device;

    
    UX_DISABLE if (device -> ux_device_flags & UX_DEVICE_FLAG_LOCK)
    {
        UX_RESTORE return(UX_STATE_LOCK);
    }

    
    device -> ux_device_flags |= UX_DEVICE_FLAG_LOCK;
    transfer_request -> ux_transfer_request_flags |= UX_TRANSFER_FLAG_AUTO_DEVICE_UNLOCK;
    UX_RESTORE    status =  _ux_host_semaphore_get(&cdc_acm -> ux_host_class_cdc_acm_device -> ux_device_protection_semaphore, UX_WAIT_FOREVER);




    
    if (status != UX_SUCCESS)

        
        return(status);


    
    transfer_request -> ux_transfer_request_data_pointer     =  data_buffer;
    transfer_request -> ux_transfer_request_requested_length =  data_length;
    transfer_request -> ux_transfer_request_function         =  command;
    transfer_request -> ux_transfer_request_type             =  request_direction | UX_REQUEST_TYPE_CLASS | UX_REQUEST_TARGET_INTERFACE;
    transfer_request -> ux_transfer_request_value            =  value;
    transfer_request -> ux_transfer_request_index            =  cdc_acm -> ux_host_class_cdc_acm_interface -> ux_interface_descriptor.bInterfaceNumber;

    
    status =  _ux_host_stack_transfer_request(transfer_request);

    
    return(status);
}

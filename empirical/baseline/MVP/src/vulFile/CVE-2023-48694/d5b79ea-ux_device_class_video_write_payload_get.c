







































































UINT _ux_device_class_video_write_payload_get(UX_DEVICE_CLASS_VIDEO_STREAM *stream, UCHAR **payload, ULONG *length)
{

UX_SLAVE_ENDPOINT           *endpoint;
UX_SLAVE_DEVICE             *device;


    
    device =  &_ux_system_slave -> ux_system_slave_device;

    
    if (device -> ux_slave_device_state != UX_DEVICE_CONFIGURED)
    {

        
        return(UX_CONFIGURATION_HANDLE_UNKNOWN);
    }

    
    endpoint = stream -> ux_device_class_video_stream_endpoint;
    if (endpoint == UX_NULL)
        return(UX_ERROR);

    
    if ((endpoint -> ux_slave_endpoint_descriptor.bEndpointAddress & UX_ENDPOINT_DIRECTION) == UX_ENDPOINT_OUT)
        return(UX_ERROR);

    
    if (stream -> ux_device_class_video_stream_access_pos == stream -> ux_device_class_video_stream_transfer_pos && stream -> ux_device_class_video_stream_access_pos -> ux_device_class_video_payload_length != 0)
        return(UX_BUFFER_OVERFLOW);

    
    *payload = stream -> ux_device_class_video_stream_access_pos -> ux_device_class_video_payload_data;

    
    *length = (stream -> ux_device_class_video_stream_payload_buffer_size - 4);

    return(UX_SUCCESS);
}


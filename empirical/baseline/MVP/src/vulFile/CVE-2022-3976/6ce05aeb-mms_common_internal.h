






















typedef struct sMmsOutstandingCall* MmsOutstandingCall;

typedef struct {
        int32_t frsmId;
        uint32_t readPosition;
        uint32_t fileSize;
        FileHandle fileHandle;


        MmsOutstandingCall obtainRequest;

} MmsFileReadStateMachine;




LIB61850_INTERNAL bool mmsMsg_parseFileOpenResponse(uint8_t* buffer, int bufPos, int maxBufPos, int32_t* frsmId, uint32_t* fileSize, uint64_t* lastModified);

LIB61850_INTERNAL bool mmsMsg_parseFileReadResponse(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t invokeId, int32_t frsmId,  bool* moreFollows, MmsConnection_FileReadHandler handler, void* handlerParameter);

LIB61850_INTERNAL void mmsMsg_createFileReadResponse(int maxPduSize, uint32_t invokeId, ByteBuffer* response,  MmsFileReadStateMachine* frsm);

LIB61850_INTERNAL void mmsMsg_createFileCloseResponse(uint32_t invokeId, ByteBuffer* response);

LIB61850_INTERNAL void mmsMsg_createFileOpenResponse(const char* basepath, uint32_t invokeId, ByteBuffer* response, char* fullPath, MmsFileReadStateMachine* frsm);

LIB61850_INTERNAL bool mmsMsg_parseFileName(char* filename, uint8_t* buffer, int* bufPos, int maxBufPos , uint32_t invokeId, ByteBuffer* response);

LIB61850_INTERNAL void mmsMsg_createExtendedFilename(const char* basepath, int bufSize, char* extendedFileName, char* fileName);

LIB61850_INTERNAL FileHandle mmsMsg_openFile(const char* basepath, char* fileName, bool readWrite);



typedef struct sMmsServiceError {
    int errorClass;
    int errorCode;
} MmsServiceError;


LIB61850_INTERNAL void  mmsMsg_createServiceErrorPdu(uint32_t invokeId, ByteBuffer* response, MmsError errorType);

LIB61850_INTERNAL void mmsMsg_createMmsRejectPdu(uint32_t* invokeId, int reason, ByteBuffer* response);

LIB61850_INTERNAL int mmsMsg_parseConfirmedErrorPDU(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t* invokeId, bool* hasInvokeId, MmsServiceError* serviceError);

LIB61850_INTERNAL int mmsMsg_parseRejectPDU(uint8_t* buffer, int bufPos, int maxBufPos, uint32_t* invokeId, bool* hasInvokeId, int* rejectType, int* rejectReason);

LIB61850_INTERNAL MmsValue* mmsMsg_parseDataElement(Data_t* dataElement);

LIB61850_INTERNAL Data_t* mmsMsg_createBasicDataElement(MmsValue* value);

LIB61850_INTERNAL AccessResult_t** mmsMsg_createAccessResultsList(MmsPdu_t* mmsPdu, int resultsCount);

LIB61850_INTERNAL char* mmsMsg_createStringFromAsnIdentifier(Identifier_t identifier);

LIB61850_INTERNAL void mmsMsg_copyAsn1IdentifierToStringBuffer(Identifier_t identifier, char* buffer, int bufSize);

LIB61850_INTERNAL char* mmsMsg_getComponentNameFromAlternateAccess(AlternateAccess_t* alternateAccess, char* componentNameBuf, int nameBufPos);

LIB61850_INTERNAL void mmsMsg_deleteAccessResultList(AccessResult_t** accessResult, int variableCount);




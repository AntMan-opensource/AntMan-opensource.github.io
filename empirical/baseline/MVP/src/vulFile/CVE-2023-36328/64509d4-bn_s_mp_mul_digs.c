





mp_err s_mp_mul_digs(const mp_int *a, const mp_int *b, mp_int *c, int digs)
{
   mp_int  t;
   mp_err  err;
   int     pa, pb, ix, iy;
   mp_digit u;
   mp_word r;
   mp_digit tmpx, *tmpt, *tmpy;

   
   if ((digs < MP_WARRAY) && (MP_MIN(a->used, b->used) < MP_MAXFAST)) {
      return s_mp_mul_digs_fast(a, b, c, digs);
   }

   if ((err = mp_init_size(&t, digs)) != MP_OKAY) {
      return err;
   }
   t.used = digs;

   
   pa = a->used;
   for (ix = 0; ix < pa; ix++) {
      
      u = 0;

      
      pb = MP_MIN(b->used, digs - ix);

      
      
      tmpx = a->dp[ix];

      
      tmpt = t.dp + ix;

      
      tmpy = b->dp;

      
      for (iy = 0; iy < pb; iy++) {
         
         r       = (mp_word)*tmpt + ((mp_word)tmpx * (mp_word)*tmpy++) + (mp_word)u;


         
         *tmpt++ = (mp_digit)(r & (mp_word)MP_MASK);

         
         u       = (mp_digit)(r >> (mp_word)MP_DIGIT_BIT);
      }
      
      if ((ix + iy) < digs) {
         *tmpt = u;
      }
   }

   mp_clamp(&t);
   mp_exch(&t, c);

   mp_clear(&t);
   return MP_OKAY;
}












SOFIA_BEGIN_DECLS                                                                       struct stun_buffer_s {






































































  unsigned char *data;      
  unsigned size;            
};

typedef struct stun_buffer_s stun_buffer_t;

typedef struct {
  uint16_t msg_type;        
  uint16_t msg_len;         
  uint8_t tran_id[16];      
} stun_hdr_t;

typedef struct stun_attr_s {
  uint16_t attr_type;       
  void *pattr;              
  stun_buffer_t enc_buf;    
  struct stun_attr_s *next; 
} stun_attr_t;

typedef struct {
  stun_hdr_t stun_hdr;
  stun_attr_t *stun_attr;
  stun_buffer_t enc_buf;    
} stun_msg_t;



typedef struct sockaddr_in stun_attr_sockaddr_t;


typedef struct stun_attr_uint32_s {
  uint32_t value;
} stun_attr_uint32_t;

typedef stun_attr_uint32_t stun_attr_changerequest_t;


typedef struct {
  int code;
  char *phrase;
} stun_attr_errorcode_t;



typedef stun_buffer_t stun_attr_username_t;


typedef stun_buffer_t stun_attr_password_t;


typedef struct stun_attr_unknownattributes_s{
  uint16_t attr_type[2];
  struct stun_attr_unknownattributes_s *next;
} stun_attr_unknownattributes_t;


int stun_parse_message(stun_msg_t *msg);
int stun_parse_attribute(stun_msg_t *msg, unsigned char *p);
int stun_parse_attr_address(stun_attr_t *attr, const unsigned char *p, unsigned len);
int stun_parse_attr_error_code(stun_attr_t *attr, const unsigned char *p, unsigned len);
int stun_parse_attr_unknown_attributes(stun_attr_t *attr, const unsigned char *p, unsigned len);
int stun_parse_attr_uint32(stun_attr_t *attr, const unsigned char *p, unsigned len);
int stun_parse_attr_buffer(stun_attr_t *attr, const unsigned char *p, unsigned len);

stun_attr_t *stun_get_attr(stun_attr_t *attr, uint16_t attr_type);

int stun_encode_address(stun_attr_t *attr);
int stun_encode_uint32(stun_attr_t *attr);
int stun_encode_buffer(stun_attr_t *attr);
int stun_encode_error_code(stun_attr_t *attr);
int stun_encode_message_integrity(stun_attr_t *attr, unsigned char *buf, int len, stun_buffer_t *pwd);
int stun_encode_type_len(stun_attr_t *attr, uint16_t len);
int stun_encode_response_address(stun_attr_t *attr);

int stun_validate_message_integrity(stun_msg_t *msg, stun_buffer_t *pwd);

int stun_copy_buffer(stun_buffer_t *p, stun_buffer_t *p2);
void stun_init_buffer(stun_buffer_t *p);
int stun_free_buffer(stun_buffer_t *p);
int stun_free_message(stun_msg_t *msg);

int stun_init_message(stun_msg_t *msg);

int stun_encode_message(stun_msg_t *msg, stun_buffer_t *pwd);

char const *stun_response_phrase(int status);
void debug_print(stun_buffer_t *buf);
char const *stun_attr_phrase(uint16_t type);


char *stun_determine_ip_address(int family);

SOFIA_END_DECLS  


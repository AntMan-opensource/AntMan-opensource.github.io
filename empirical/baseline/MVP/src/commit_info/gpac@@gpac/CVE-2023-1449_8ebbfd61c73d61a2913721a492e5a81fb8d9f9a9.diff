commit 8ebbfd61c73d61a2913721a492e5a81fb8d9f9a9
Author: Aurelien David <aurelien.david@telecom-paristech.fr>
Date:   Fri Feb 10 15:36:49 2023 +0100

    av1: flush samples on parse error (#2387)

diff --git a/src/filters/reframe_av1.c b/src/filters/reframe_av1.c
index 4f3241128..034db6e4e 100644
--- a/src/filters/reframe_av1.c
+++ b/src/filters/reframe_av1.c
@@ -57,7 +57,7 @@ typedef struct
 	Double index;
 	Bool importer;
 	Bool deps, notime, temporal_delim;
-	
+
 	u32 bsdbg;
 
 	//only one input pid declared
@@ -932,7 +932,7 @@ static GF_Err av1dmx_parse_flush_sample(GF_Filter *filter, GF_AV1DmxCtx *ctx)
 
 	if (!ctx->opid)
 		return GF_NON_COMPLIANT_BITSTREAM;
-		
+
 	gf_bs_get_content_no_truncate(ctx->state.bs, &ctx->state.frame_obus, &pck_size, &ctx->state.frame_obus_alloc);
 
 	if (!pck_size) {
@@ -1036,7 +1036,12 @@ GF_Err av1dmx_parse_av1(GF_Filter *filter, GF_AV1DmxCtx *ctx)
 	if (ctx->timescale && (e==GF_BUFFER_TOO_SMALL))
 		e = GF_OK;
 
-	if (e) return e;
+	if (e) {
+		if (e!=GF_EOS && e!=GF_BUFFER_TOO_SMALL) {
+			av1dmx_parse_flush_sample(filter, ctx);
+		}
+		return e;
+	}
 
 
 	if (!ctx->opid) {
@@ -1391,4 +1396,3 @@ const GF_FilterRegister *av1dmx_register(GF_FilterSession *session)
 	return NULL;
 }
 #endif // GPAC_DISABLE_AV_PARSERS
-

commit d414df635c773b21bbb3a9fbf17b101b1e8ea345
Author: jeanlf <jeanlf@gpac.io>
Date:   Tue Jul 4 16:48:58 2023 +0200

    fixed #2514

diff --git a/src/bifs/com_dec.c b/src/bifs/com_dec.c
index 00509f08a..44583bfb3 100644
--- a/src/bifs/com_dec.c
+++ b/src/bifs/com_dec.c
@@ -860,6 +860,7 @@ static GF_Err BD_DecIndexValueReplace(GF_BifsDecoder * codec, GF_BitStream *bs)
 		pos = 0;
 		break;
 	case 3:
+		if (!field.far_ptr) return GF_NON_COMPLIANT_BITSTREAM;
 		pos = ((GenMFField *) field.far_ptr)->count - 1;
 		break;
 	default:
diff --git a/src/bifs/memory_decoder.c b/src/bifs/memory_decoder.c
index d617d3355..faf35c16d 100644
--- a/src/bifs/memory_decoder.c
+++ b/src/bifs/memory_decoder.c
@@ -770,6 +770,7 @@ GF_Err BM_ParseIndexValueReplace(GF_BifsDecoder *codec, GF_BitStream *bs, GF_Lis
 		pos = 0;
 		break;
 	case 3:
+		if (!field.far_ptr) return GF_NON_COMPLIANT_BITSTREAM;
 		pos = ((GenMFField *) field.far_ptr)->count - 1;
 		break;
 	default:
diff --git a/src/scenegraph/commands.c b/src/scenegraph/commands.c
index c529a0d59..2bfaa719b 100644
--- a/src/scenegraph/commands.c
+++ b/src/scenegraph/commands.c
@@ -335,6 +335,7 @@ GF_Err gf_sg_command_apply(GF_SceneGraph *graph, GF_Command *com, Double time_of
 			}
 			/*erase the field item*/
 			else {
+				if (!field.far_ptr) return GF_NON_COMPLIANT_BITSTREAM;
 				if ((inf->pos < 0) || ((u32) inf->pos >= ((GenMFField *) field.far_ptr)->count) ) {
 					inf->pos = ((GenMFField *)field.far_ptr)->count - 1;
 					/*may happen with text and default value*/
@@ -398,6 +399,7 @@ GF_Err gf_sg_command_apply(GF_SceneGraph *graph, GF_Command *com, Double time_of
 		if (gf_sg_vrml_get_sf_type(field.fieldType) == GF_SG_VRML_SFNODE) {
 			e = gf_node_replace_child(com->node, (GF_ChildNodeItem **) field.far_ptr, inf->pos, NULL);
 		} else {
+			if (!field.far_ptr) return GF_NON_COMPLIANT_BITSTREAM;
 			if ((inf->pos < 0) || ((u32) inf->pos >= ((GenMFField *) field.far_ptr)->count) ) {
 				inf->pos = ((GenMFField *)field.far_ptr)->count - 1;
 			}
@@ -566,6 +568,7 @@ GF_Err gf_sg_command_apply(GF_SceneGraph *graph, GF_Command *com, Double time_of
 			/*erase the field item*/
 			else {
 				u32 sftype;
+				if (!field.far_ptr) return GF_NON_COMPLIANT_BITSTREAM;
 				if ((pos < 0) || ((u32) pos >= ((GenMFField *) field.far_ptr)->count) ) {
 					pos = ((GenMFField *)field.far_ptr)->count - 1;
 					/*may happen with text and default value*/

commit 22346a74c07ceb90296be872be2d53eb92252a54
Author: DavidKorczynski <david@adalogics.com>
Date:   Thu May 6 19:52:11 2021 +0100

    parser: json: fix double-free (#3453)
    
    Signed-off-by: davkor <david@adalogics.com>

diff --git a/src/flb_parser_json.c b/src/flb_parser_json.c
index 1afc39a6a..972197708 100644
--- a/src/flb_parser_json.c
+++ b/src/flb_parser_json.c
@@ -111,6 +111,7 @@ int flb_parser_json_do(struct flb_parser *parser,
     *out_size = tmp_out_size;
     if (mp_buf != tmp_out_buf) {
         flb_free(mp_buf);
+        mp_buf = NULL;
     }
 
     /* Do time resolution ? */
@@ -141,6 +142,7 @@ int flb_parser_json_do(struct flb_parser *parser,
         /* Ensure the pointer we are about to read is not NULL */
         if (k->via.str.ptr == NULL) {
             flb_free(mp_buf);
+            flb_free(tmp_out_buf);
             *out_buf = NULL;
             msgpack_unpacked_destroy(&result);
             return -1;

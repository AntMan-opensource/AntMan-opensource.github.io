commit 33aa7f07d54ae066f201c6d298cb4a2181cb90e6
Author: Luca Weiss <luca@lucaweiss.eu>
Date:   Sun Dec 4 12:45:07 2022 +0100

    driver: Sanitize data_size value returned from devices
    
    We're using this value for some bounds checks and we should ensure that
    we don't potentially get a data_size that's bigger than the arguments
    array to avoid out of bounds reads.

diff --git a/driver/razercommon.c b/driver/razercommon.c
index 125d1607..5c1b2983 100644
--- a/driver/razercommon.c
+++ b/driver/razercommon.c
@@ -107,6 +107,14 @@ int razer_get_usb_response(struct usb_device *usb_dev, uint report_index, struct
         result = 1;
     }
 
+    if (WARN_ONCE(response_report->data_size > ARRAY_SIZE(response_report->arguments),
+                  "Field data_size %d in response is bigger than arguments\n",
+                  response_report->data_size)) {
+        /* Sanitize the value since at the moment callers don't respect the return code */
+        response_report->data_size = ARRAY_SIZE(response_report->arguments);
+        return -EINVAL;
+    }
+
     return result;
 }
 

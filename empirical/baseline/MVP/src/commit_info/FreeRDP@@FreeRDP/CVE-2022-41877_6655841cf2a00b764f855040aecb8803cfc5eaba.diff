commit 6655841cf2a00b764f855040aecb8803cfc5eaba
Author: akallabeth <akallabeth@posteo.net>
Date:   Mon Oct 24 08:45:05 2022 +0200

    Fixed missing stream length check in drive_file_query_directory
    
    (cherry picked from commit 4e4bb79795d6ac85473fb7a83e53ccf63d204b93)

diff --git a/channels/drive/client/drive_main.c b/channels/drive/client/drive_main.c
index 1b5422522..35dc704e0 100644
--- a/channels/drive/client/drive_main.c
+++ b/channels/drive/client/drive_main.c
@@ -629,6 +629,9 @@ static UINT drive_process_irp_query_directory(DRIVE_DEVICE* drive, IRP* irp)
 	Stream_Read_UINT32(irp->input, PathLength);
 	Stream_Seek(irp->input, 23); /* Padding */
 	path = (WCHAR*)Stream_Pointer(irp->input);
+	if (!Stream_CheckAndLogRequiredLength(TAG, irp->input, PathLength))
+		return ERROR_INVALID_DATA;
+
 	file = drive_get_file_by_id(drive, irp->FileId);
 
 	if (file == NULL)

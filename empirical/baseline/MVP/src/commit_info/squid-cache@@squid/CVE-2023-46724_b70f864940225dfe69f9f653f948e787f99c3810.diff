commit b70f864940225dfe69f9f653f948e787f99c3810
Author: Andreas Weigel <andreas.weigel@securepoint.de>
Date:   Wed Oct 18 04:14:31 2023 +0000

    Fix validation of certificates with CN=* (#1523)
    
    The bug was discovered and detailed by Joshua Rogers at
    https://megamansec.github.io/Squid-Security-Audit/
    where it was filed as "Buffer UnderRead in SSL CN Parsing".

diff --git a/src/anyp/Uri.cc b/src/anyp/Uri.cc
index 3eed2366a..ef77d4f76 100644
--- a/src/anyp/Uri.cc
+++ b/src/anyp/Uri.cc
@@ -175,6 +175,10 @@ urlInitialize(void)
     assert(0 == matchDomainName("*.foo.com", ".foo.com", mdnHonorWildcards));
     assert(0 != matchDomainName("*.foo.com", "foo.com", mdnHonorWildcards));
 
+    assert(0 != matchDomainName("foo.com", ""));
+    assert(0 != matchDomainName("foo.com", "", mdnHonorWildcards));
+    assert(0 != matchDomainName("foo.com", "", mdnRejectSubsubDomains));
+
     /* more cases? */
 }
 
@@ -828,6 +832,8 @@ matchDomainName(const char *h, const char *d, MatchDomainNameFlags flags)
         return -1;
 
     dl = strlen(d);
+    if (dl == 0)
+        return 1;
 
     /*
      * Start at the ends of the two strings and work towards the

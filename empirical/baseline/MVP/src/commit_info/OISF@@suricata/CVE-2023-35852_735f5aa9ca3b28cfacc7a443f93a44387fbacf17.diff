commit 735f5aa9ca3b28cfacc7a443f93a44387fbacf17
Author: Jason Ish <jason.ish@oisf.net>
Date:   Tue Jun 6 16:04:56 2023 -0600

    datasets: flag to disable "write" actions
    
    Add a new configuration flag, "datasets.rules.allow-write" to control
    if rules can contain "save" or "state" rules which allow write access
    to the file system.
    
    Ticket: #6123

diff --git a/src/detect-dataset.c b/src/detect-dataset.c
index 3659812af..ca3d5d971 100644
--- a/src/detect-dataset.c
+++ b/src/detect-dataset.c
@@ -302,6 +302,15 @@ static int SetupSavePath(const DetectEngineCtx *de_ctx,
 {
     SCLogDebug("save %s", save);
 
+    int allow_save = 1;
+    if (ConfGetBool("datasets.rules.allow-write", &allow_save)) {
+        if (!allow_save) {
+            SCLogError(SC_ERR_INVALID_SIGNATURE,
+                    "Rules containing save/state datasets have been disabled");
+            return -1;
+        }
+    }
+
     int allow_absolute = 0;
     (void)ConfGetBool("datasets.rules.allow-absolute-filenames", &allow_absolute);
     if (allow_absolute) {
diff --git a/suricata.yaml.in b/suricata.yaml.in
index e842f42e8..7145b1282 100644
--- a/suricata.yaml.in
+++ b/suricata.yaml.in
@@ -1004,6 +1004,11 @@ asn1-max-frames: 256
 #    # ".." components to reference parent directories in rules that specify
 #    # their filenames.
 #    #allow-absolute-filenames: false
+#
+#    # Allow datasets in rules write access for "save" and
+#    # "state". This is enabled by default, however write access is
+#    # limited to the data directory.
+#    #allow-write: true
 
 ##############################################################################
 ##

commit b97bf3566071a8176c6e1add9af9abbfa6d89173
Author: Rob White <rob@blue-wave.net>
Date:   Fri Jul 28 21:31:34 2023 +0100

    Fix - NULL pointer dereference if user_agent is NULL
    
    Signed-off-by: Rob White <rob@blue-wave.net>

diff --git a/src/http_microhttpd.c b/src/http_microhttpd.c
index 9fcc63f..dff5231 100644
--- a/src/http_microhttpd.c
+++ b/src/http_microhttpd.c
@@ -145,6 +145,10 @@ static int do_binauth(
 	user_agent = safe_calloc(USER_AGENT);
 	MHD_get_connection_values(connection, MHD_HEADER_KIND, get_user_agent_callback, &user_agent);
 
+	if (user_agent == NULL) {
+		return send_error(connection, 403);
+	}
+
 	debug(LOG_DEBUG, "BinAuth: User Agent is [ %s ]", user_agent);
 
 	// Get custom data string as passed in the query string
@@ -984,6 +988,10 @@ static int show_preauthpage(struct MHD_Connection *connection, const char *query
 
 		MHD_get_connection_values(connection, MHD_HEADER_KIND, get_user_agent_callback, &user_agent);
 
+		if (user_agent == NULL) {
+			return send_error(connection, 403);
+		}
+
 		uh_urlencode(enc_user_agent, ENC_USER_AGENT, user_agent, strlen(user_agent));
 		debug(LOG_DEBUG, "PreAuth: Encoded User Agent is [ %s ]", enc_user_agent);
 

commit a7de776fdf7518d74522168f1c0960241f18e110
Author: Mitko Iliev <imitko@openlinksw.com>
Date:   Wed Nov 15 11:00:19 2023 +0100

    Fixed issue with missing cast on return type (fixes #1172)
    
    The return type from searched case as well as control expression
    cannot be predicted as it can be any type, so we have to cast
    explicitly to column type.

diff --git a/libsrc/Wi/sqlvec.c b/libsrc/Wi/sqlvec.c
index 9fbcede28..25071564f 100644
--- a/libsrc/Wi/sqlvec.c
+++ b/libsrc/Wi/sqlvec.c
@@ -1702,6 +1702,8 @@ sqlg_vec_setp (sql_comp_t * sc, setp_node_t * setp, dk_hash_t * res)
 int
 ssl_needs_ins_cast (state_slot_t * ssl, dbe_column_t * col)
 {
+  if (ssl->ssl_is_callret)
+    return 1;
   if (DV_WIDE == col->col_sqt.sqt_dtp && (DV_ANY == ssl->ssl_dc_dtp && DV_WIDE == ssl->ssl_sqt.sqt_dtp))
     return 0;
   if (DV_STRING == col->col_sqt.sqt_dtp && (DV_ANY == ssl->ssl_dc_dtp && DV_STRING == ssl->ssl_sqt.sqt_dtp))

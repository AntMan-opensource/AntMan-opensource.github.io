commit 64a82e284dddabaeb549228380103b57dead32a6
Author: Sergi Ã€lvarez i Capilla <pancake@nowsecure.com>
Date:   Fri Apr 8 20:39:43 2022 +0200

    Fix UAF in `aaef` ##crash
    
    * Reported by @hdthky
    * Reproducer: uaf-aef
    * BountyID: e98ad92c-3a64-48fb-84d4-d13afdbcbdd7

diff --git a/libr/core/canal.c b/libr/core/canal.c
index fb53e75fc3..610cd22f21 100644
--- a/libr/core/canal.c
+++ b/libr/core/canal.c
@@ -5295,10 +5295,6 @@ R_API void r_core_anal_esil(RCore *core, const char *str, const char *target) {
 		arch = R2_ARCH_MIPS;
 	}
 
-	const char *sn = r_reg_get_name (core->anal->reg, R_REG_NAME_SN);
-	if (!sn) {
-		eprintf ("Warning: No SN reg alias for current architecture.\n");
-	}
 	r_reg_arena_push (core->anal->reg);
 
 	IterCtx ictx = { start, end, fcn, NULL };
@@ -5409,6 +5405,10 @@ R_API void r_core_anal_esil(RCore *core, const char *str, const char *target) {
 				goto repeat;
 			}
 		}
+		const char *sn = r_reg_get_name (core->anal->reg, R_REG_NAME_SN);
+		if (!sn) {
+			eprintf ("Warning: No SN reg alias for current architecture.\n");
+		}
 		if (sn && op.type == R_ANAL_OP_TYPE_SWI) {
 			r_strf_buffer (64);
 			r_flag_space_set (core->flags, R_FLAGS_FS_SYSCALLS);

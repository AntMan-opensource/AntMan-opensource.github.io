commit 22bde976e5e6eea26d3d6c830a668a96dddd4680
Author: Jonathan Rico <jonathan.rico@nordicsemi.no>
Date:   Thu Sep 7 10:13:56 2023 +0200

    Bluetooth: l2cap: validate `reconfigure` packet length
    
    The specification only allows up to 5 16-bit CIDs in this PDU.
    Enforce it.
    
    Signed-off-by: Jonathan Rico <jonathan.rico@nordicsemi.no>

diff --git a/subsys/bluetooth/host/l2cap.c b/subsys/bluetooth/host/l2cap.c
index 7203faf8b2f..2af255a622e 100644
--- a/subsys/bluetooth/host/l2cap.c
+++ b/subsys/bluetooth/host/l2cap.c
@@ -1363,6 +1363,12 @@ static void le_ecred_reconf_req(struct bt_l2cap *l2cap, uint8_t ident,
 		goto response;
 	}
 
+	/* The specification only allows up to 5 CIDs in this packet */
+	if (buf->len > (L2CAP_ECRED_CHAN_MAX_PER_REQ * sizeof(scid))) {
+		result = BT_L2CAP_RECONF_OTHER_UNACCEPT;
+		goto response;
+	}
+
 	while (buf->len >= sizeof(scid)) {
 		struct bt_l2cap_chan *chan;
 		scid = net_buf_pull_le16(buf);

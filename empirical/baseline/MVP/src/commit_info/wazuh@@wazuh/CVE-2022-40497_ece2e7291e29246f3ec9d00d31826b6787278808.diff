commit ece2e7291e29246f3ec9d00d31826b6787278808
Author: Vikman Fernandez-Castro <victor@wazuh.com>
Date:   Mon Sep 5 11:01:05 2022 +0200

    Fix path traversal flaw in custom Active response commands

diff --git a/src/os_execd/exec.c b/src/os_execd/exec.c
index 2cc9c83776..76e71b42dd 100644
--- a/src/os_execd/exec.c
+++ b/src/os_execd/exec.c
@@ -159,6 +159,11 @@ char *GetCommandbyName(const char *name, int *timeout)
     // Filter custom commands
 
     if (name[0] == '!') {
+        if (w_ref_parent_folder(name + 1)) {
+            mwarn("Active response command '%s' vulnerable to directory traversal attack. Ignoring.", name + 1);
+            return NULL;
+        }
+
         static char command[OS_FLSIZE];
 
         if (snprintf(command, sizeof(command), "%s/%s", AR_BINDIRPATH, name + 1) >= (int)sizeof(command)) {

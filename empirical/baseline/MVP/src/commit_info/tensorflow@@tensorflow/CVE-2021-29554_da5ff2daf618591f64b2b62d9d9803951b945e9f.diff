commit da5ff2daf618591f64b2b62d9d9803951b945e9f
Author: Amit Patankar <amitpatankar@google.com>
Date:   Wed Apr 28 11:24:45 2021 -0700

    Fix FPE issue with `tf.raw_ops.DenseCountSparseOutput`.
    
    PiperOrigin-RevId: 370946862
    Change-Id: I3752584ad04aaecb327ff6793a9640ac56acfe7a

diff --git a/tensorflow/core/kernels/count_ops.cc b/tensorflow/core/kernels/count_ops.cc
index eeb0b853c7a..40aa1fe458c 100644
--- a/tensorflow/core/kernels/count_ops.cc
+++ b/tensorflow/core/kernels/count_ops.cc
@@ -122,6 +122,9 @@ class DenseCount : public OpKernel {
 
     int num_batch_elements = 1;
     for (int i = 0; i < num_batch_dimensions; ++i) {
+      OP_REQUIRES(context, data.shape().dim_size(i) != 0,
+                  errors::InvalidArgument(
+                      "Invalid input: Shapes dimension cannot be 0."));
       num_batch_elements *= data.shape().dim_size(i);
     }
     int num_value_elements = data.shape().num_elements() / num_batch_elements;

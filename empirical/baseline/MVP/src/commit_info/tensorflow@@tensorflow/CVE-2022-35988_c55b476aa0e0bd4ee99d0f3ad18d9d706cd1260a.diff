commit c55b476aa0e0bd4ee99d0f3ad18d9d706cd1260a
Author: Antonio Sanchez <cantonios@google.com>
Date:   Wed Jul 20 12:59:24 2022 -0700

    Fix empty batch issue in svd.
    
    If there are zero batches, the GPU kernel previously failed with a `work_element_count > 0`
    check failure.  In the zero batch case, there is no output, so simply return.
    
    PiperOrigin-RevId: 462210670

diff --git a/tensorflow/core/kernels/linalg/svd_op_gpu.cu.cc b/tensorflow/core/kernels/linalg/svd_op_gpu.cu.cc
index a3532f765a4..6168baac069 100644
--- a/tensorflow/core/kernels/linalg/svd_op_gpu.cu.cc
+++ b/tensorflow/core/kernels/linalg/svd_op_gpu.cu.cc
@@ -395,6 +395,12 @@ class SvdOpGpu : public AsyncOpKernel {
     OP_REQUIRES_OK_ASYNC(context, context->allocate_output(2, shapeV, &outputV),
                          done);
 
+    // If there are zero batches, we are done.
+    if (shapeRaw.num_elements() == 0) {
+      done();
+      return;
+    }
+
     if (n == 0 || m == 0) {
       if (n == m || !compute_uv_ || !full_matrices_) {
         // S, U, and V are all empty. Nothing to do.
diff --git a/tensorflow/python/kernel_tests/linalg/svd_op_test.py b/tensorflow/python/kernel_tests/linalg/svd_op_test.py
index 7a4182b8105..8ceca06beff 100644
--- a/tensorflow/python/kernel_tests/linalg/svd_op_test.py
+++ b/tensorflow/python/kernel_tests/linalg/svd_op_test.py
@@ -108,6 +108,14 @@ class SvdOpTest(test.TestCase):
     for i in range(0, len(val), 2):
       self.assertAllEqual(val[i], val[i + 1])
 
+  @test_util.run_in_graph_and_eager_modes(use_gpu=True)
+  def testEmptyBatches(self):
+    matrices = constant_op.constant(1.0, shape=[0, 2, 2])
+    s, u, v = self.evaluate(linalg_ops.svd(matrices))
+    self.assertAllEqual(s, np.zeros([0, 2]))
+    self.assertAllEqual(u, np.zeros([0, 2, 2]))
+    self.assertAllEqual(v, np.zeros([0, 2, 2]))
+
 
 def _GetSvdOpTest(dtype_, shape_, use_static_shape_, compute_uv_,
                   full_matrices_):

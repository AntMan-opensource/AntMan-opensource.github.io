commit cff267650c6a1b266e4b4500f69fbc49cdd773c5
Author: Alan Liu <liualan@google.com>
Date:   Thu Apr 28 13:08:57 2022 -0700

    Fix tf.raw_ops.DeleteSessionTensor vulnerability with invalid `handle`.
    
    Check that `handle` input is actually a scalar before treating it as such.
    
    PiperOrigin-RevId: 445228994

diff --git a/tensorflow/core/kernels/session_ops.cc b/tensorflow/core/kernels/session_ops.cc
index bb47288b157..2feb79a24e3 100644
--- a/tensorflow/core/kernels/session_ops.cc
+++ b/tensorflow/core/kernels/session_ops.cc
@@ -134,6 +134,8 @@ class DeleteSessionTensorOp : public OpKernel {
 
   void Compute(OpKernelContext* ctx) override {
     const Tensor& handle = ctx->input(0);
+    OP_REQUIRES(ctx, TensorShapeUtils::IsScalar(handle.shape()),
+                errors::InvalidArgument("`handle` must be scalar"));
     const string& name = handle.scalar<tstring>()();
     auto session_state = ctx->session_state();
     OP_REQUIRES(ctx, session_state != nullptr,

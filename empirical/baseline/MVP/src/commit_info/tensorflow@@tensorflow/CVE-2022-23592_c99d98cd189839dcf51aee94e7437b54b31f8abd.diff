commit c99d98cd189839dcf51aee94e7437b54b31f8abd
Author: Dan Moldovan <mdan@google.com>
Date:   Fri Nov 12 17:42:30 2021 -0800

    Handle invalid inputs instead of crashing.
    
    PiperOrigin-RevId: 409549744
    Change-Id: I7f5935b34b53f7e426a5462fcc027bdbf5dcda24

diff --git a/tensorflow/core/graph/graph.cc b/tensorflow/core/graph/graph.cc
index 2e3703b6603..4af258a2038 100644
--- a/tensorflow/core/graph/graph.cc
+++ b/tensorflow/core/graph/graph.cc
@@ -222,10 +222,16 @@ void Node::RunForwardTypeInference() {
       const auto& node_t = node->def().experimental_type();
       if (node_t.type_id() != TFT_UNSET) {
         int ix = input_idx[i];
-        DCHECK(ix < node_t.args_size())
-            << "input " << i << " should have an output " << ix
-            << " but instead only has " << node_t.args_size()
-            << " outputs: " << node_t.DebugString();
+        if (ix >= node_t.args_size()) {
+          LOG(WARNING) << name() << " has bad type information: input " << i
+                       << " should have an output " << ix
+                       << " but instead only has " << node_t.args_size()
+                       << " outputs: " << node_t.DebugString()
+                       << "\nThis indicates either "
+                          "a bug in op registration or a corrupted graph.";
+          ClearTypeInfo();
+          return;
+        }
         input_types.emplace_back(node_t.args(ix));
       } else {
         input_types.emplace_back(*no_type);

commit a5b89cd68c02329d793356bda85d079e9e69b4e7
Author: Antonio Sanchez <cantonios@google.com>
Date:   Fri Apr 29 21:07:06 2022 -0700

    Fix empty resource handle vulnerability.
    
    Some ops that attempt to extract a resource handle from user input
    can lead to nullptr dereferences.  This returns an error in such
    a case.
    
    PiperOrigin-RevId: 445571938

diff --git a/tensorflow/core/common_runtime/eager/execute.cc b/tensorflow/core/common_runtime/eager/execute.cc
index dd64174a4dd..904996c7e64 100644
--- a/tensorflow/core/common_runtime/eager/execute.cc
+++ b/tensorflow/core/common_runtime/eager/execute.cc
@@ -304,6 +304,9 @@ Status GetDeviceForInput(const EagerOperation& op, const EagerContext& ctx,
     const Tensor* tensor;
     // TODO(fishx): Avoid blocking here.
     TF_RETURN_IF_ERROR(tensor_handle->Tensor(&tensor));
+    if (tensor->NumElements() == 0) {
+      return errors::InvalidArgument("Empty resource handle");
+    }
     const ResourceHandle& handle = tensor->flat<ResourceHandle>()(0);
     device_name = handle.device();
 

commit 92dba16749fae36c246bec3f9ba474d9ddeb7662
Author: Mihai Maruseac <mihaimaruseac@google.com>
Date:   Thu Nov 11 10:43:29 2021 -0800

    Prevent a null-pointer dereference / `CHECK`-fail in grappler.
    
    PiperOrigin-RevId: 409187354
    Change-Id: I369c249cca32e6c56ec193f0ebbf2f2768fc7d43

diff --git a/tensorflow/core/grappler/optimizers/dependency_optimizer.cc b/tensorflow/core/grappler/optimizers/dependency_optimizer.cc
index aadea833a4f..bfd98a58a77 100644
--- a/tensorflow/core/grappler/optimizers/dependency_optimizer.cc
+++ b/tensorflow/core/grappler/optimizers/dependency_optimizer.cc
@@ -75,8 +75,10 @@ bool DependencyOptimizer::SafeToRemoveIdentity(const NodeDef& node) const {
   }
 
   const NodeDef* input = node_map_->GetNode(NodeName(node.input(0)));
-  CHECK(input != nullptr) << "node = " << node.name()
-                          << " input = " << node.input(0);
+  if (input == nullptr) {
+    VLOG(1) << "node = " << node.name() << " input = " << node.input(0);
+    return false;
+  }
   // Don't remove Identity nodes corresponding to Variable reads or following
   // Recv.
   if (IsVariable(*input) || IsRecv(*input)) {

commit 955059813cc325dc1db5e2daa6221271406d4439
Author: Dan Moldovan <mdan@google.com>
Date:   Fri Nov 12 08:17:57 2021 -0800

    Check for type inference error on node construction.
    
    PiperOrigin-RevId: 409415804
    Change-Id: Ieb6e020906b96f522bf8e2fa103715ddbbdc434a

diff --git a/tensorflow/core/graph/graph.cc b/tensorflow/core/graph/graph.cc
index 397a45c9773..2e3703b6603 100644
--- a/tensorflow/core/graph/graph.cc
+++ b/tensorflow/core/graph/graph.cc
@@ -561,6 +561,11 @@ Node* Graph::AddNode(NodeDef node_def, Status* status) {
     VLOG(3) << "AddNode: found type constructor for " << node_def.name();
     const auto ctor_type =
         full_type::SpecializeType(AttrSlice(node_def), op_reg_data->op_def);
+    if (!ctor_type.ok()) {
+      *status = errors::InvalidArgument("type error: ",
+                                        ctor_type.status().ToString());
+      return nullptr;
+    }
     const FullTypeDef ctor_typedef = ctor_type.ValueOrDie();
     if (ctor_typedef.type_id() != TFT_UNSET) {
       *(node_def.mutable_experimental_type()) = ctor_typedef;

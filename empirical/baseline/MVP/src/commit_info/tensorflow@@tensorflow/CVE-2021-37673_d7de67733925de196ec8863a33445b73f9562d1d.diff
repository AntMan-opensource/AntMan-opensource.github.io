commit d7de67733925de196ec8863a33445b73f9562d1d
Author: Mihai Maruseac <mihaimaruseac@google.com>
Date:   Thu Jul 29 22:23:46 2021 -0700

    Prevent a CHECK-fail due to empty tensor input in `map_stage_op.cc`
    
    PiperOrigin-RevId: 387737906
    Change-Id: Idc52df0c71c7ed6e2dd633b651a581932f277c8a

diff --git a/tensorflow/core/kernels/map_stage_op.cc b/tensorflow/core/kernels/map_stage_op.cc
index b575c2d3862..9411792762b 100644
--- a/tensorflow/core/kernels/map_stage_op.cc
+++ b/tensorflow/core/kernels/map_stage_op.cc
@@ -527,6 +527,8 @@ class MapStageOp : public OpKernel {
     OP_REQUIRES_OK(ctx, ctx->input("key", &key_tensor));
     OP_REQUIRES_OK(ctx, ctx->input("indices", &indices_tensor));
     OP_REQUIRES_OK(ctx, ctx->input_list("values", &values_tensor));
+    OP_REQUIRES(ctx, key_tensor->NumElements() > 0,
+                errors::InvalidArgument("key must not be empty"));
 
     // Create copy for insertion into Staging Area
     Tensor key(*key_tensor);

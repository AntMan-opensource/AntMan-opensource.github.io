commit 84563f265f28b3c36a15335c8b005d405260e943
Author: Mihai Maruseac <mihaimaruseac@google.com>
Date:   Fri Apr 15 10:34:16 2022 -0700

    Validate `num_segments > 0` in `unsorted_segment_join`
    
    Fixes #55305
    
    PiperOrigin-RevId: 442047005

diff --git a/tensorflow/core/kernels/unsorted_segment_join_op.cc b/tensorflow/core/kernels/unsorted_segment_join_op.cc
index 2406f9b0d7c..860cec80100 100644
--- a/tensorflow/core/kernels/unsorted_segment_join_op.cc
+++ b/tensorflow/core/kernels/unsorted_segment_join_op.cc
@@ -94,6 +94,8 @@ class UnsortedSegmentJoinOp : public OpKernel {
                 errors::InvalidArgument("Number of segments cannot be empty."));
     auto num_segments = num_segments_tensor.scalar<NUM_SEGMENTS_TYPE>()();
 
+    OP_REQUIRES(context, num_segments > 0,
+                errors::InvalidArgument("Number of segments must be positive"));
     OP_REQUIRES(context, segment_dims != 0,
                 errors::InvalidArgument("Segment_id cannot have rank 0"));
 

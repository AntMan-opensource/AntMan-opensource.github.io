commit 290bb05c80c327ed74fae1d089f1001b1e2a4ef7
Author: Alan Liu <liualan@google.com>
Date:   Thu Apr 28 11:02:25 2022 -0700

    Fix tf.raw_ops.TensorSummaryV2 vulnerability with invalid serialized_summary_metadata.
    
    Check that input is actually a scalar before treating it as such.
    
    PiperOrigin-RevId: 445197183

diff --git a/tensorflow/core/kernels/summary_tensor_op.cc b/tensorflow/core/kernels/summary_tensor_op.cc
index e367045b02a..730ef6f38e5 100644
--- a/tensorflow/core/kernels/summary_tensor_op.cc
+++ b/tensorflow/core/kernels/summary_tensor_op.cc
@@ -36,6 +36,10 @@ class SummaryTensorOpV2 : public OpKernel {
                 errors::InvalidArgument("tag must be scalar"));
     const Tensor& tensor = c->input(1);
     const Tensor& serialized_summary_metadata_tensor = c->input(2);
+    OP_REQUIRES(
+        c,
+        TensorShapeUtils::IsScalar(serialized_summary_metadata_tensor.shape()),
+        errors::InvalidArgument("serialized_summary_metadata must be scalar"));
 
     Summary s;
     Summary::Value* v = s.add_value();

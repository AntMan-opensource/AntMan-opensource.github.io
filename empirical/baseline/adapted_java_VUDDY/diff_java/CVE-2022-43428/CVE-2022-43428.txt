commit 5fca6eb21599f8f27323dfa17a6e44f8176ca551
Author: Ajay Asati <117740822+aasat@users.noreply.github.com>
Date:   Fri Dec 9 13:44:16 2022 +0530

    SECURITY-2624:Arbitrary file read vulnerability due to empty role check (#52)
    
    * SECURITY-2624:Arbitrary file read vulnerability due to empty role check
    
    * SECURITY-2624:Missing permission check - Changed copyright

diff --git a/src/main/java/com/compuware/jenkins/totaltest/RemoteSystemProperties.java b/src/main/java/com/compuware/jenkins/totaltest/RemoteSystemProperties.java
index 57c9c4d..e318c45 100644
--- a/src/main/java/com/compuware/jenkins/totaltest/RemoteSystemProperties.java
+++ b/src/main/java/com/compuware/jenkins/totaltest/RemoteSystemProperties.java
@@ -2,6 +2,7 @@
  * The MIT License (MIT)
  * 
  * Copyright (c) 2015 - 2018 Compuware Corporation
+ * (c) Copyright 2020-2022 BMC Software, Inc.
  * 
  * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
  * files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy,
@@ -19,27 +20,16 @@ package com.compuware.jenkins.totaltest;
 
 import java.util.Properties;
 
-import org.jenkinsci.remoting.RoleChecker;
-
-import hudson.remoting.Callable;
+import jenkins.security.MasterToSlaveCallable;
 
 /**
  * Get remote system properties
  */
-public class RemoteSystemProperties implements Callable<Properties, RuntimeException>
+public class RemoteSystemProperties extends MasterToSlaveCallable<Properties, RuntimeException>
 {
 	private static final long serialVersionUID = -8859580651709239685L;
 
-	public Properties call()
-	{
+	public Properties call() {
 		return System.getProperties();
 	}
-
-	/* (non-Javadoc)
-	 * @see org.jenkinsci.remoting.RoleSensitive#checkRoles(org.jenkinsci.remoting.RoleChecker)
-	 */
-	@Override
-	public void checkRoles(RoleChecker checker) throws SecurityException
-	{
-	}
 }
diff --git a/src/main/java/com/compuware/jenkins/totaltest/TotalTestRunnerUtils.java b/src/main/java/com/compuware/jenkins/totaltest/TotalTestRunnerUtils.java
index 57cba4d..c0b2875 100644
--- a/src/main/java/com/compuware/jenkins/totaltest/TotalTestRunnerUtils.java
+++ b/src/main/java/com/compuware/jenkins/totaltest/TotalTestRunnerUtils.java
@@ -2,7 +2,7 @@
  * The MIT License (MIT)
  * 
  * Copyright (c) 2015-2020 Compuware Corporation
- * (c) Copyright 2019-2020 BMC Software, Inc.
+ * (c) Copyright 2019-2020 & 2020-2022BMC Software, Inc.
  * 
  * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
  * files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy,
@@ -26,14 +26,16 @@ import java.nio.file.Files;
 import java.nio.file.Paths;
 import java.util.Collections;
 import java.util.List;
+
 import org.apache.commons.lang.StringUtils;
-import org.jenkinsci.remoting.RoleChecker;
+
 import com.cloudbees.plugins.credentials.CredentialsProvider;
 import com.cloudbees.plugins.credentials.common.StandardUsernamePasswordCredentials;
 import com.cloudbees.plugins.credentials.domains.DomainRequirement;
 import com.cloudbees.plugins.credentials.matchers.IdMatcher;
 import com.compuware.jenkins.common.configuration.CpwrGlobalConfiguration;
 import com.compuware.jenkins.common.utils.CLIVersionUtils;
+
 import hudson.FilePath;
 import hudson.FilePath.FileCallable;
 import hudson.Launcher;
@@ -42,6 +44,7 @@ import hudson.model.Item;
 import hudson.model.TaskListener;
 import hudson.remoting.VirtualChannel;
 import hudson.security.ACL;
+import jenkins.MasterToSlaveFileCallable;
 import jenkins.model.Jenkins;
 
 public class TotalTestRunnerUtils
@@ -504,13 +507,9 @@ public class TotalTestRunnerUtils
 	 * @see hudson.FilePath#act(FileCallable)
 	 * 
 	 */
-	public static class GetRemoteUTF8FileContents implements FileCallable<String> {
+	public static class GetRemoteUTF8FileContents extends MasterToSlaveFileCallable<String> {
 		private static final long serialVersionUID = 1L;
 		
-		/*
-		 * (non-Javadoc)
-		 * @see hudson.FileCallable#invoke(File file, hudson.VirtualChannel channel)
-		 */
 		@Override
 		public String invoke(File file, VirtualChannel channel) throws IOException, InterruptedException {
 			String retVal = null;
@@ -522,14 +521,6 @@ public class TotalTestRunnerUtils
 			return retVal;
 		}
 
-		/*
-		 * (non-Javadoc)
-		 * @see org.jenkinsci.remoting.RoleChecker#checkRoles(hudson.RoleChecker arg0l)
-		 */
-		@Override
-		public void checkRoles(RoleChecker arg0) throws SecurityException {
-			// TODO Auto-generated method stub
-		}
 	}
 
 }

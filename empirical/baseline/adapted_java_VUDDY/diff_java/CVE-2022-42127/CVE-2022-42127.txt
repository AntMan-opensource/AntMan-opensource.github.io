commit 7c485275c297810f87f67c0966db6b59bc47fd2f
Author: Alicia Garc√≠a <alicia.garcia@liferay.com>
Date:   Thu Jul 28 09:44:59 2022 +0200

    LPS-158880 if no view permission return success false

diff --git a/modules/apps/friendly-url/friendly-url-web/src/main/java/com/liferay/friendly/url/web/internal/servlet/FriendlyURLServlet.java b/modules/apps/friendly-url/friendly-url-web/src/main/java/com/liferay/friendly/url/web/internal/servlet/FriendlyURLServlet.java
index feefa8a88f90b..b7c06a38b56da 100644
--- a/modules/apps/friendly-url/friendly-url-web/src/main/java/com/liferay/friendly/url/web/internal/servlet/FriendlyURLServlet.java
+++ b/modules/apps/friendly-url/friendly-url-web/src/main/java/com/liferay/friendly/url/web/internal/servlet/FriendlyURLServlet.java
@@ -36,6 +36,7 @@ import com.liferay.portal.kernel.log.LogFactoryUtil;
 import com.liferay.portal.kernel.model.User;
 import com.liferay.portal.kernel.security.permission.ActionKeys;
 import com.liferay.portal.kernel.security.permission.PermissionCheckerFactoryUtil;
+import com.liferay.portal.kernel.security.permission.PermissionCheckerFactory;
 import com.liferay.portal.kernel.util.ContentTypes;
 import com.liferay.portal.kernel.util.GetterUtil;
 import com.liferay.portal.kernel.util.ListUtil;
@@ -125,11 +126,28 @@ public class FriendlyURLServlet extends HttpServlet {
 				_writeJSON(httpServletResponse, JSONUtil.put("success", false));
 			}
 			else {
-				_writeJSON(
-					httpServletResponse,
-					_getFriendlyURLEntryLocalizationsJSONObject(
-						_getClassName(httpServletRequest),
-						_getClassPK(httpServletRequest)));
+				String className = _getClassName(httpServletRequest);
+				long classPK = _getClassPK(httpServletRequest);
+
+				InfoItemPermissionProvider<Object> infoItemPermissionProvider =
+					_infoItemServiceTracker.getFirstInfoItemService(
+						InfoItemPermissionProvider.class, className);
+
+				if (!infoItemPermissionProvider.hasPermission(
+						_permissionCheckerFactory.create(
+							_portal.getUser(httpServletRequest)),
+						new InfoItemReference(className, classPK),
+						ActionKeys.VIEW)) {
+
+					_writeJSON(
+						httpServletResponse, JSONUtil.put("success", false));
+				}
+				else {
+					_writeJSON(
+						httpServletResponse,
+						_getFriendlyURLEntryLocalizationsJSONObject(
+							className, classPK));
+				}
 			}
 		}
 		catch (Exception exception) {
@@ -340,6 +358,9 @@ public class FriendlyURLServlet extends HttpServlet {
 	@Reference
 	private InfoItemServiceTracker _infoItemServiceTracker;
 
+	@Reference
+	private PermissionCheckerFactory _permissionCheckerFactory;
+
 	@Reference
 	private Portal _portal;
 

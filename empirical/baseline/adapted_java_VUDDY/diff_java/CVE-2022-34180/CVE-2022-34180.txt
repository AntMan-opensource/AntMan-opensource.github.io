commit 402148784b3f4b029eaf47cc26ebf6b9bc636183
Author: Daniel Beck <daniel-beck@users.noreply.github.com>
Date:   Tue Jun 21 10:58:50 2022 +0200

    [SECURITY-2794]

diff --git a/src/main/java/org/jenkinsci/plugins/badge/actions/PublicBuildStatusAction.java b/src/main/java/org/jenkinsci/plugins/badge/actions/PublicBuildStatusAction.java
index 40a5ee0..0215c1e 100644
--- a/src/main/java/org/jenkinsci/plugins/badge/actions/PublicBuildStatusAction.java
+++ b/src/main/java/org/jenkinsci/plugins/badge/actions/PublicBuildStatusAction.java
@@ -134,8 +134,11 @@ public class PublicBuildStatusAction implements UnprotectedRootAction {
         }
 
         // check if user has permission to view the status
-        if(throwErrorWhenNotFound && (p == null || !p.hasPermission(VIEW_STATUS))){
-            throw HttpResponses.notFound();            
+        if (p == null || !p.hasPermission(VIEW_STATUS)) {
+            if (throwErrorWhenNotFound) {
+                throw HttpResponses.notFound();
+            }
+            return null;
         }
         
         return p;
@@ -180,8 +183,11 @@ public class PublicBuildStatusAction implements UnprotectedRootAction {
             }    
         }
         // check if user has permission to view the status
-        if(throwErrorWhenNotFound && (run == null || !run.hasPermission(VIEW_STATUS))){
-            throw HttpResponses.notFound();
+        if (run == null || !run.hasPermission(VIEW_STATUS)) {
+            if (throwErrorWhenNotFound) {
+                throw HttpResponses.notFound();
+            }
+            return null;
         }
 
         return run;

commit 021eb79ba312fe5a7f99fa867ee5350aa5533069
Author: Benoit TELLIER <btellier@linagora.com>
Date:   Tue Nov 22 09:14:14 2022 +0700

    MIME4J-322 Rely on Files.createTempFile (#82)

diff --git a/storage/src/main/java/org/apache/james/mime4j/storage/TempFileStorageProvider.java b/storage/src/main/java/org/apache/james/mime4j/storage/TempFileStorageProvider.java
index ac13cd98..0e87f928 100644
--- a/storage/src/main/java/org/apache/james/mime4j/storage/TempFileStorageProvider.java
+++ b/storage/src/main/java/org/apache/james/mime4j/storage/TempFileStorageProvider.java
@@ -26,8 +26,10 @@ import java.io.FileOutputStream;
 import java.io.IOException;
 import java.io.InputStream;
 import java.io.OutputStream;
+import java.nio.file.Files;
 import java.util.HashSet;
 import java.util.Iterator;
+import java.util.Optional;
 import java.util.Set;
 
 import org.apache.commons.io.FileUtils;
@@ -107,7 +109,12 @@ public class TempFileStorageProvider extends AbstractStorageProvider {
     }
 
     public StorageOutputStream createStorageOutputStream() throws IOException {
-        File file = File.createTempFile(prefix, suffix, directory);
+        File file;
+        if (directory == null) {
+            file = Files.createTempFile(prefix, suffix).toFile();
+        } else {
+            file = Files.createTempFile(directory.toPath(), prefix, suffix).toFile();
+        }
         file.deleteOnExit();
 
         return new TempFileStorageOutputStream(file);

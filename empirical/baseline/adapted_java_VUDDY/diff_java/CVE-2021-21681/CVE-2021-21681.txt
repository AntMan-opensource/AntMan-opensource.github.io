commit d45123487d57c0e2a8a6869866b05362f690f511
Author: Jonathan Ballet <jon@multani.info>
Date:   Wed Jun 23 13:20:30 2021 +0200

    SECURITY-2396

diff --git a/src/main/java/org/jenkinsci/plugins/nomad/NomadApi.java b/src/main/java/org/jenkinsci/plugins/nomad/NomadApi.java
index b148e44..67855f0 100755
--- a/src/main/java/org/jenkinsci/plugins/nomad/NomadApi.java
+++ b/src/main/java/org/jenkinsci/plugins/nomad/NomadApi.java
@@ -116,7 +116,7 @@ public final class NomadApi {
         if (template.getUsername() != null && !template.getUsername().isEmpty()) {
             Map<String, String> authConfig = new HashMap<>();
             authConfig.put("username", template.getUsername());
-            authConfig.put("password", template.getPassword());
+            authConfig.put("password", template.getPassword().getPlainText());
 
             ArrayList<Map> credentials = new ArrayList<>();
             credentials.add(authConfig);
diff --git a/src/main/java/org/jenkinsci/plugins/nomad/NomadWorkerTemplate.java b/src/main/java/org/jenkinsci/plugins/nomad/NomadWorkerTemplate.java
index c43dcd7..fed2860 100755
--- a/src/main/java/org/jenkinsci/plugins/nomad/NomadWorkerTemplate.java
+++ b/src/main/java/org/jenkinsci/plugins/nomad/NomadWorkerTemplate.java
@@ -7,6 +7,7 @@ import hudson.model.Descriptor;
 import hudson.model.Label;
 import hudson.model.Node;
 import hudson.model.labels.LabelAtom;
+import hudson.util.Secret;
 import jenkins.model.Jenkins;
 import org.apache.commons.lang.StringUtils;
 import org.kohsuke.stapler.DataBoundConstructor;
@@ -39,7 +40,7 @@ public class NomadWorkerTemplate implements Describable<NomadWorkerTemplate> {
     private final Boolean privileged;
     private final String network;
     private final String username;
-    private final String password;
+    private final Secret password;
     private final String prefixCmd;
     private final Boolean forcePull;
     private final String hostVolumes;
@@ -76,7 +77,7 @@ public class NomadWorkerTemplate implements Describable<NomadWorkerTemplate> {
             String image,
             String datacenters,
             String username,
-            String password,
+            Secret password,
             Boolean privileged,
             String network,
             String prefixCmd,
@@ -239,7 +240,7 @@ public class NomadWorkerTemplate implements Describable<NomadWorkerTemplate> {
         return username;
     }
 
-    public String getPassword() {
+    public Secret getPassword() {
         return password;
     }
 
diff --git a/src/test/java/org/jenkinsci/plugins/nomad/NomadApiTest.java b/src/test/java/org/jenkinsci/plugins/nomad/NomadApiTest.java
index 463f9dd..eb3d2c2 100755
--- a/src/test/java/org/jenkinsci/plugins/nomad/NomadApiTest.java
+++ b/src/test/java/org/jenkinsci/plugins/nomad/NomadApiTest.java
@@ -1,6 +1,7 @@
 package org.jenkinsci.plugins.nomad;
 
 import hudson.model.Node;
+import hudson.util.Secret;
 import org.junit.Test;
 
 import java.util.Arrays;
@@ -24,7 +25,7 @@ public class NomadApiTest {
     private final NomadWorkerTemplate workerTemplate = new NomadWorkerTemplate(
             "test", "300", "256", "100",
             null, constraintTest, "remoteFs", false, "3", true, "1", Node.Mode.NORMAL,
-            "ams", "0", "image", "dc01", "", "", false, "bridge",
+            "ams", "0", "image", "dc01", "", Secret.fromString(""), false, "bridge",
             "", true, "/mnt:/mnt", "jenkins", new ArrayList<NomadPortTemplate>() {
     },
             "my_host:192.168.1.1,", "8.8.8.8,1.1.1.1", "apparmor=unconfined, seccomp=unconfined", "SYS_ADMIN, SYSLOG", "SYS_ADMIN, SYSLOG", "policy1,policy2", devicePluginsTest
@@ -63,7 +64,7 @@ public class NomadApiTest {
     private final NomadWorkerTemplate nullTemplate = new NomadWorkerTemplate(
             "test", "300", "256", "100",
             null, constraintTest, "remoteFs", false, "3", true, "1", Node.Mode.NORMAL,
-            "ams", "0", "image", "dc01", "", "", false, "bridge",
+            "ams", "0", "image", "dc01", "", Secret.fromString(""), false, "bridge",
             "", true, "/mnt:/mnt", "jenkins", new ArrayList<NomadPortTemplate>() {
     },
             "my_host:192.168.1.1,", "8.8.8.8,1.1.1.1", "apparmor=unconfined, seccomp=unconfined", "SYS_ADMIN, SYSLOG", "SYS_ADMIN, SYSLOG", null, devicePluginsTest

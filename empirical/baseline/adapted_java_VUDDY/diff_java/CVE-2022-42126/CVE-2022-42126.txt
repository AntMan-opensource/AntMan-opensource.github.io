commit f06d03062b45305ca0cbcbb03df14b0a181830ed
Author: Noor Najjar <noor.najjar@liferay.com>
Date:   Mon May 23 15:00:27 2022 -0700

    LPS-154342 Filter depot groups

diff --git a/modules/apps/depot/depot-service/src/main/java/com/liferay/depot/service/impl/DepotEntryServiceImpl.java b/modules/apps/depot/depot-service/src/main/java/com/liferay/depot/service/impl/DepotEntryServiceImpl.java
index 9585b72871e2f..62f2e6e2c03fe 100644
--- a/modules/apps/depot/depot-service/src/main/java/com/liferay/depot/service/impl/DepotEntryServiceImpl.java
+++ b/modules/apps/depot/depot-service/src/main/java/com/liferay/depot/service/impl/DepotEntryServiceImpl.java
@@ -20,13 +20,16 @@ import com.liferay.depot.model.DepotEntry;
 import com.liferay.depot.service.base.DepotEntryServiceBaseImpl;
 import com.liferay.portal.aop.AopService;
 import com.liferay.portal.kernel.exception.PortalException;
+import com.liferay.portal.kernel.model.Group;
 import com.liferay.portal.kernel.security.permission.ActionKeys;
+import com.liferay.portal.kernel.security.permission.PermissionChecker;
 import com.liferay.portal.kernel.security.permission.resource.ModelResourcePermission;
 import com.liferay.portal.kernel.security.permission.resource.PortletResourcePermission;
 import com.liferay.portal.kernel.service.ServiceContext;
 import com.liferay.portal.kernel.service.permission.GroupPermission;
 import com.liferay.portal.kernel.util.UnicodeProperties;
 
+import java.util.ArrayList;
 import java.util.Collections;
 import java.util.List;
 import java.util.Locale;
@@ -108,14 +111,32 @@ public class DepotEntryServiceImpl extends DepotEntryServiceBaseImpl {
 			long groupId, int start, int end)
 		throws PortalException {
 
+		PermissionChecker permissionChecker = getPermissionChecker();
+
 		if (!_groupPermission.contains(
-				getPermissionChecker(), groupId, ActionKeys.VIEW)) {
+				permissionChecker, groupId, ActionKeys.VIEW)) {
 
 			return Collections.emptyList();
 		}
 
-		return depotEntryLocalService.getGroupConnectedDepotEntries(
-			groupId, start, end);
+		List<DepotEntry> filteredDepotEntries = new ArrayList<>();
+
+		for (DepotEntry depotEntry :
+				depotEntryLocalService.getGroupConnectedDepotEntries(
+					groupId, start, end)) {
+
+			Group group = depotEntry.getGroup();
+
+			if (group.isCompany() ||
+				_groupPermission.contains(
+					permissionChecker, group.getGroupId(), ActionKeys.VIEW) ||
+				permissionChecker.isGroupAdmin(group.getGroupId())) {
+
+				filteredDepotEntries.add(depotEntry);
+			}
+		}
+
+		return filteredDepotEntries;
 	}
 
 	@Override

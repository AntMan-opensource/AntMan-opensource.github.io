commit b410f40233394d1d3d1076189befd4b33ba9fb47
Author: Eudaldo Alonso <eudaldo.alonso@liferay.com>
Date:   Mon Jun 26 17:48:22 2023 +0200

    LPS-188789 Uses service impl method to filter organizations by permissions

diff --git a/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/OrganizationItemSelectorView.java b/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/OrganizationItemSelectorView.java
index b24a5628b919c..e819f6578fda2 100644
--- a/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/OrganizationItemSelectorView.java
+++ b/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/OrganizationItemSelectorView.java
@@ -21,7 +21,7 @@ import com.liferay.item.selector.criteria.UUIDItemSelectorReturnType;
 import com.liferay.organizations.item.selector.OrganizationItemSelectorCriterion;
 import com.liferay.organizations.item.selector.web.internal.display.context.OrganizationItemSelectorViewDisplayContext;
 import com.liferay.portal.kernel.language.Language;
-import com.liferay.portal.kernel.service.OrganizationLocalService;
+import com.liferay.portal.kernel.service.OrganizationService;
 import com.liferay.portal.kernel.util.Portal;
 import com.liferay.users.admin.kernel.util.UsersAdmin;
 
@@ -79,9 +79,8 @@ public class OrganizationItemSelectorView
 		OrganizationItemSelectorViewDisplayContext
 			organizationItemSelectorViewDisplayContext =
 				new OrganizationItemSelectorViewDisplayContext(
-					organizationItemSelectorCriterion,
-					_organizationLocalService, _usersAdmin, httpServletRequest,
-					portletURL);
+					organizationItemSelectorCriterion, _organizationService,
+					_usersAdmin, httpServletRequest, portletURL);
 
 		_itemSelectorViewDescriptorRenderer.renderHTML(
 			httpServletRequest, servletResponse,
@@ -104,7 +103,7 @@ public class OrganizationItemSelectorView
 	private Language _language;
 
 	@Reference
-	private OrganizationLocalService _organizationLocalService;
+	private OrganizationService _organizationService;
 
 	@Reference
 	private Portal _portal;
diff --git a/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/display/context/OrganizationItemSelectorViewDisplayContext.java b/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/display/context/OrganizationItemSelectorViewDisplayContext.java
index 561c40397f078..a08fa0a66d526 100644
--- a/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/display/context/OrganizationItemSelectorViewDisplayContext.java
+++ b/modules/apps/organizations/organizations-item-selector-web/src/main/java/com/liferay/organizations/item/selector/web/internal/display/context/OrganizationItemSelectorViewDisplayContext.java
@@ -20,9 +20,8 @@ import com.liferay.portal.kernel.dao.search.SearchContainer;
 import com.liferay.portal.kernel.exception.PortalException;
 import com.liferay.portal.kernel.model.Organization;
 import com.liferay.portal.kernel.model.OrganizationConstants;
-import com.liferay.portal.kernel.search.SortFactoryUtil;
 import com.liferay.portal.kernel.security.auth.CompanyThreadLocal;
-import com.liferay.portal.kernel.service.OrganizationLocalService;
+import com.liferay.portal.kernel.service.OrganizationService;
 import com.liferay.portal.kernel.util.JavaConstants;
 import com.liferay.portal.kernel.util.ParamUtil;
 import com.liferay.portlet.usersadmin.search.OrganizationSearch;
@@ -42,12 +41,11 @@ public class OrganizationItemSelectorViewDisplayContext {
 
 	public OrganizationItemSelectorViewDisplayContext(
 		OrganizationItemSelectorCriterion organizationItemSelectorCriterion,
-		OrganizationLocalService organizationLocalService,
-		UsersAdmin usersAdmin, HttpServletRequest httpServletRequest,
-		PortletURL portletURL) {
+		OrganizationService organizationService, UsersAdmin usersAdmin,
+		HttpServletRequest httpServletRequest, PortletURL portletURL) {
 
 		_organizationItemSelectorCriterion = organizationItemSelectorCriterion;
-		_organizationLocalService = organizationLocalService;
+		_organizationService = organizationService;
 		_usersAdmin = usersAdmin;
 		_portletURL = portletURL;
 
@@ -87,14 +85,16 @@ public class OrganizationItemSelectorViewDisplayContext {
 			(OrganizationSearchTerms)_searchContainer.getSearchTerms();
 
 		_searchContainer.setResultsAndTotal(
-			_organizationLocalService.searchOrganizations(
+			() -> _organizationService.getOrganizations(
 				CompanyThreadLocal.getCompanyId(),
 				OrganizationConstants.ANY_PARENT_ORGANIZATION_ID,
-				organizationSearchTerms.getKeywords(), null,
+				organizationSearchTerms.getKeywords(),
 				_searchContainer.getStart(), _searchContainer.getEnd(),
-				SortFactoryUtil.getSort(
-					Organization.class, _searchContainer.getOrderByCol(),
-					_searchContainer.getOrderByType())));
+				_searchContainer.getOrderByComparator()),
+			_organizationService.getOrganizationsCount(
+				CompanyThreadLocal.getCompanyId(),
+				OrganizationConstants.ANY_PARENT_ORGANIZATION_ID,
+				organizationSearchTerms.getKeywords()));
 
 		_searchContainer.setRowChecker(
 			new OrganizationItemSelectorChecker(
@@ -107,7 +107,7 @@ public class OrganizationItemSelectorViewDisplayContext {
 
 	private final OrganizationItemSelectorCriterion
 		_organizationItemSelectorCriterion;
-	private final OrganizationLocalService _organizationLocalService;
+	private final OrganizationService _organizationService;
 	private final PortletURL _portletURL;
 	private final RenderRequest _renderRequest;
 	private final RenderResponse _renderResponse;

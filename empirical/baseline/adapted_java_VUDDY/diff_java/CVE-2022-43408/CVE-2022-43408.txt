commit cee275109ee748fa9f599ec60159807a28a2933f
Author: James Nord <jtnord@users.noreply.github.com>
Date:   Wed Oct 12 22:12:58 2022 +0200

    [SECURITY-2828]

diff --git a/rest-api/src/main/java/com/cloudbees/workflow/rest/endpoints/RunAPI.java b/rest-api/src/main/java/com/cloudbees/workflow/rest/endpoints/RunAPI.java
index 1c3087a..4f8b1b0 100644
--- a/rest-api/src/main/java/com/cloudbees/workflow/rest/endpoints/RunAPI.java
+++ b/rest-api/src/main/java/com/cloudbees/workflow/rest/endpoints/RunAPI.java
@@ -45,6 +45,10 @@ import org.kohsuke.stapler.Stapler;
 import org.kohsuke.stapler.interceptor.RequirePOST;
 
 import javax.servlet.ServletException;
+import java.io.UnsupportedEncodingException;
+import java.net.URLEncoder;
+import java.nio.charset.Charset;
+import java.nio.charset.StandardCharsets;
 import java.util.ArrayList;
 import java.util.List;
 import java.util.concurrent.TimeoutException;
@@ -85,7 +89,11 @@ public class RunAPI extends AbstractWorkflowRunActionHandler {
     }
 
     public static String getInputStepSubmitUrl(WorkflowRun run, String inputId) {
-        return getUrl(run) + "inputSubmit?inputId=" + inputId;
+        try {
+            return getUrl(run) + "inputSubmit?inputId=" + URLEncoder.encode(inputId, StandardCharsets.UTF_8.name());
+        } catch (UnsupportedEncodingException e) {
+            throw new AssertionError("UTF-8 is a mandated charset, yet the JVM does not provide support for it", e);
+        }
     }
 
     public static String getArtifactUrl(WorkflowRun run, Run<WorkflowJob, WorkflowRun>.Artifact artifact) {
diff --git a/rest-api/src/main/java/com/cloudbees/workflow/rest/external/PendingInputActionsExt.java b/rest-api/src/main/java/com/cloudbees/workflow/rest/external/PendingInputActionsExt.java
index 3c77c96..2a6d1d0 100644
--- a/rest-api/src/main/java/com/cloudbees/workflow/rest/external/PendingInputActionsExt.java
+++ b/rest-api/src/main/java/com/cloudbees/workflow/rest/external/PendingInputActionsExt.java
@@ -26,6 +26,7 @@ package com.cloudbees.workflow.rest.external;
 import com.cloudbees.workflow.rest.endpoints.RunAPI;
 import com.cloudbees.workflow.util.ModelUtil;
 import com.fasterxml.jackson.annotation.JsonInclude;
+import hudson.Util;
 import hudson.model.ParameterDefinition;
 import org.jenkinsci.plugins.workflow.job.WorkflowRun;
 import org.jenkinsci.plugins.workflow.support.steps.input.InputAction;
@@ -117,7 +118,7 @@ public class PendingInputActionsExt {
         String runUrl = ModelUtil.getFullItemUrl(run.getUrl());
         inputActionExt.setInputs(getInputParams(inputId, run));
         inputActionExt.setProceedUrl(RunAPI.getInputStepSubmitUrl(run, inputId));
-        inputActionExt.setAbortUrl(runUrl + "input/" + inputId + "/abort");
+        inputActionExt.setAbortUrl(runUrl + "input/" + Util.rawEncode(inputId) + "/abort");
         inputActionExt.setRedirectApprovalUrl(runUrl + "input/");
 
         return inputActionExt;

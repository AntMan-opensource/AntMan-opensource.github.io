commit 0b8ece92c93c41f21b255bc360aab381e77e637e
Author: Brian Chan <brian.chan@liferay.com>
Date:   Thu Sep 23 18:42:31 2021 -0300

    LPS-138324 sort

diff --git a/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/notification/EmailNotificationSender.java b/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/notification/EmailNotificationSender.java
index ee00179b8f965..ff553964bd62e 100644
--- a/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/notification/EmailNotificationSender.java
+++ b/modules/apps/calendar/calendar-service/src/main/java/com/liferay/calendar/internal/notification/EmailNotificationSender.java
@@ -87,6 +87,9 @@ public class EmailNotificationSender implements NotificationSender {
 
 			subscriptionSender.addFileAttachment(
 				(File)notificationTemplateContext.getAttribute("icsFile"));
+			subscriptionSender.addRuntimeSubscribers(
+				notificationRecipient.getEmailAddress(),
+				notificationRecipient.getName());
 			subscriptionSender.setClassName(
 				CalendarBookingLocalServiceImpl.class.getName());
 			subscriptionSender.setClassPK(
@@ -94,9 +97,9 @@ public class EmailNotificationSender implements NotificationSender {
 			subscriptionSender.setCompanyId(
 				notificationTemplateContext.getCompanyId());
 			subscriptionSender.setContextAttributes(
-				"[$COMPANY_ID$]", notificationTemplateContext.getCompanyId(),
 				"[$CALENDAR_NAME$]",
 				notificationTemplateContext.getAttribute("calendarName"),
+				"[$COMPANY_ID$]", notificationTemplateContext.getCompanyId(),
 				"[$EVENT_END_DATE$]",
 				notificationTemplateContext.getAttribute("endTime"),
 				"[$EVENT_LOCATION$]",
@@ -122,6 +125,14 @@ public class EmailNotificationSender implements NotificationSender {
 				notificationTemplateContext.getFromName());
 			subscriptionSender.setHtmlFormat(
 				notificationRecipient.isHTMLFormat());
+			subscriptionSender.setMailId(
+				"event", notificationTemplateContext.getCalendarId());
+			subscriptionSender.setPortletId(
+				PortletProviderUtil.getPortletId(
+					CalendarBooking.class.getName(),
+					PortletProvider.Action.EDIT));
+			subscriptionSender.setScopeGroupId(
+				notificationTemplateContext.getGroupId());
 
 			CalendarNotificationTemplate calendarNotificationTemplate =
 				notificationTemplateContext.getCalendarNotificationTemplate();
@@ -147,18 +158,6 @@ public class EmailNotificationSender implements NotificationSender {
 						NotificationTemplateRenderer.MODE_PLAIN));
 			}
 
-			subscriptionSender.setMailId(
-				"event", notificationTemplateContext.getCalendarId());
-			subscriptionSender.setPortletId(
-				PortletProviderUtil.getPortletId(
-					CalendarBooking.class.getName(),
-					PortletProvider.Action.EDIT));
-			subscriptionSender.setScopeGroupId(
-				notificationTemplateContext.getGroupId());
-			subscriptionSender.addRuntimeSubscribers(
-				notificationRecipient.getEmailAddress(),
-				notificationRecipient.getName());
-
 			subscriptionSender.flushNotificationsAsync();
 		}
 		catch (Exception exception) {

commit ce7a71db0bb34ecbcb0e822d40598e410a48b399
Author: Werner Froidevaux <wfro64@users.noreply.github.com>
Date:   Fri Oct 20 09:27:17 2023 +0200

    fixes XML eXternal Entity injection (XXE)

diff --git a/core/src/main/java/org/opencrx/application/uses/net/sf/webdav/methods/WebDavMethod.java b/core/src/main/java/org/opencrx/application/uses/net/sf/webdav/methods/WebDavMethod.java
index 8fe5570..d7264e5 100644
--- a/core/src/main/java/org/opencrx/application/uses/net/sf/webdav/methods/WebDavMethod.java
+++ b/core/src/main/java/org/opencrx/application/uses/net/sf/webdav/methods/WebDavMethod.java
@@ -221,16 +221,40 @@ public abstract class WebDavMethod {
     }
 
     /**
-     * Return JAXP document builder instance.
+     * Get XML document builder.
+     * 
+     * @return
+     * @throws ServiceException
      */
     protected DocumentBuilder getDocumentBuilder(
     ) throws ServiceException {
         DocumentBuilder documentBuilder = null;
         DocumentBuilderFactory documentBuilderFactory = null;
+        documentBuilderFactory = DocumentBuilderFactory.newInstance();
+        documentBuilderFactory.setNamespaceAware(true);
+        // Flags required to prevent XML eXternal Entity injection (XXE)
+        try {
+        	documentBuilderFactory.setFeature("http://apache.org/xml/features/disallow-doctype-decl", true);
+        } catch (ParserConfigurationException e) {
+            throw new ServiceException(e);
+        }
+        try {
+        	documentBuilderFactory.setFeature("http://xml.org/sax/features/external-general-entities", false);
+        } catch (ParserConfigurationException e) {
+            throw new ServiceException(e);
+        }
+        try {
+        	documentBuilderFactory.setFeature("http://xml.org/sax/features/external-parameter-entities", false);
+        } catch (ParserConfigurationException e) {
+            throw new ServiceException(e);
+        }
+        try {
+        	documentBuilderFactory.setFeature("http://apache.org/xml/features/nonvalidating/load-external-dtd", false);
+        } catch (ParserConfigurationException e) {
+            throw new ServiceException(e);
+        }
         try {
-            documentBuilderFactory = DocumentBuilderFactory.newInstance();
-            documentBuilderFactory.setNamespaceAware(true);
-            documentBuilder = documentBuilderFactory.newDocumentBuilder();
+        	documentBuilder = documentBuilderFactory.newDocumentBuilder();
         } catch (ParserConfigurationException e) {
             throw new ServiceException(e);
         }

commit df5c7fe4df54e40b33ab252370d578d9b99dfcb5
Author: Francesco Chicchiricc√≤ <ilgrosso@apache.org>
Date:   Mon Jun 11 09:13:06 2018 +0200

    [SYNCOPE-1318] The actual fix: in case of uncontrolled error, do proper logout

diff --git a/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleRequestCycleListener.java b/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleRequestCycleListener.java
index 91e55e63e4..50c5748184 100644
--- a/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleRequestCycleListener.java
+++ b/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleRequestCycleListener.java
@@ -99,8 +99,7 @@ public class SyncopeConsoleRequestCycleListener extends AbstractRequestCycleList
 
         if (errorPage instanceof Login) {
             try {
-                SyncopeConsoleSession.get().cleanup();
-                SyncopeConsoleSession.get().invalidateNow();
+                SyncopeConsoleSession.get().invalidate();
             } catch (Throwable t) {
                 // ignore
                 LOG.debug("Unexpected error while forcing logout after error", t);
diff --git a/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleSession.java b/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleSession.java
index 74b1db060c..aa8a28c5f8 100644
--- a/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleSession.java
+++ b/client/console/src/main/java/org/apache/syncope/client/console/SyncopeConsoleSession.java
@@ -199,18 +199,6 @@ public class SyncopeConsoleSession extends AuthenticatedWebSession {
         super.invalidate();
     }
 
-    @Override
-    public void invalidateNow() {
-        if (getJWT() != null) {
-            if (client != null) {
-                client.logout();
-            }
-            cleanup();
-        }
-        executor.shutdown();
-        super.invalidateNow();
-    }
-
     public UserTO getSelfTO() {
         return selfTO;
     }

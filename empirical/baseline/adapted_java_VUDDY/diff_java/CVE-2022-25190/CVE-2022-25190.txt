commit eda06cde26cdf2d40ae4e2f4d2709e8174489068
Author: CyberArk BizDev <edward.nunez@cyberark.com>
Date:   Wed Feb 9 14:32:24 2022 -0800

    Fix for SECURITY-2350

diff --git a/src/main/java/org/conjur/jenkins/api/ConjurAPI.java b/src/main/java/org/conjur/jenkins/api/ConjurAPI.java
index 9a6e700..4d8658f 100644
--- a/src/main/java/org/conjur/jenkins/api/ConjurAPI.java
+++ b/src/main/java/org/conjur/jenkins/api/ConjurAPI.java
@@ -9,16 +9,16 @@ import java.util.Map;
 import java.util.logging.Level;
 import java.util.logging.Logger;
 
+import com.cloudbees.hudson.plugins.folder.AbstractFolder;
 import com.cloudbees.plugins.credentials.CredentialsMatchers;
 import com.cloudbees.plugins.credentials.CredentialsProvider;
 import com.cloudbees.plugins.credentials.common.UsernamePasswordCredentials;
 import com.cloudbees.plugins.credentials.domains.DomainRequirement;
-import com.cloudbees.hudson.plugins.folder.AbstractFolder;
 
 import org.conjur.jenkins.configuration.ConjurConfiguration;
 import org.conjur.jenkins.configuration.ConjurJITJobProperty;
-import org.conjur.jenkins.configuration.GlobalConjurConfiguration;
 import org.conjur.jenkins.configuration.FolderConjurConfiguration;
+import org.conjur.jenkins.configuration.GlobalConjurConfiguration;
 import org.conjur.jenkins.jwtauth.impl.JwtToken;
 
 import hudson.model.AbstractItem;
diff --git a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsDescriptor.java b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsDescriptor.java
index 3f4af4e..16527d9 100644
--- a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsDescriptor.java
+++ b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsDescriptor.java
@@ -10,6 +10,7 @@ import org.kohsuke.stapler.QueryParameter;
 import hudson.model.Item;
 import hudson.security.ACL;
 import hudson.util.ListBoxModel;
+import jenkins.model.Jenkins;
 
 //@Extension
 public class ConjurSecretCredentialsDescriptor extends CredentialsDescriptor {
@@ -20,6 +21,7 @@ public class ConjurSecretCredentialsDescriptor extends CredentialsDescriptor {
 	}
 
 	public ListBoxModel doFillCredentialIDItems(@AncestorInPath final Item item, @QueryParameter final String uri) {
+		Jenkins.get().checkPermission(Jenkins.ADMINISTER);
 		return new StandardListBoxModel().includeAs(ACL.SYSTEM, item, ConjurSecretCredentials.class,
 				URIRequirementBuilder.fromUri(uri).build());
 	}
diff --git a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsImpl.java b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsImpl.java
index 76b60e2..28eef7d 100644
--- a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsImpl.java
+++ b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretCredentialsImpl.java
@@ -19,7 +19,6 @@ import org.kohsuke.stapler.DataBoundSetter;
 
 import hudson.Extension;
 import hudson.model.ModelObject;
-import hudson.remoting.Channel;
 import hudson.util.Secret;
 import okhttp3.OkHttpClient;
 
diff --git a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameCredentialsImpl.java b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameCredentialsImpl.java
index e7816b4..2eb07e8 100644
--- a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameCredentialsImpl.java
+++ b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameCredentialsImpl.java
@@ -22,6 +22,7 @@ import hudson.model.ModelObject;
 import hudson.security.ACL;
 import hudson.util.ListBoxModel;
 import hudson.util.Secret;
+import jenkins.model.Jenkins;
 
 @NameWith(value = ConjurSecretCredentials.NameProvider.class, priority = 1)
 
@@ -94,7 +95,7 @@ public class ConjurSecretUsernameCredentialsImpl extends BaseStandardCredentials
 		}
 
 		public ListBoxModel doFillCredentialIDItems(@AncestorInPath final Item item, @QueryParameter final String uri) {
-			LOGGER.log(Level.FINE, "CONJUR SECRET CREDENTIALS DESCRIPTor");
+			Jenkins.get().checkPermission(Jenkins.ADMINISTER);
 			return new StandardListBoxModel().includeAs(ACL.SYSTEM, item, ConjurSecretCredentials.class,
 					URIRequirementBuilder.fromUri(uri).build());
 		}
diff --git a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameSSHKeyCredentialsImpl.java b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameSSHKeyCredentialsImpl.java
index 8b3ef5b..8064a31 100644
--- a/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameSSHKeyCredentialsImpl.java
+++ b/src/main/java/org/conjur/jenkins/conjursecrets/ConjurSecretUsernameSSHKeyCredentialsImpl.java
@@ -24,6 +24,7 @@ import hudson.model.ModelObject;
 import hudson.security.ACL;
 import hudson.util.ListBoxModel;
 import hudson.util.Secret;
+import jenkins.model.Jenkins;
 
 
 public class ConjurSecretUsernameSSHKeyCredentialsImpl extends BaseSSHUser
@@ -96,6 +97,7 @@ implements ConjurSecretUsernameSSHKeyCredentials {
 		}
 
 		public ListBoxModel doFillCredentialIDItems(@AncestorInPath final Item item, @QueryParameter final String uri) {
+			Jenkins.get().checkPermission(Jenkins.ADMINISTER);
 			return new StandardListBoxModel().includeAs(ACL.SYSTEM, item, ConjurSecretCredentials.class,
 					URIRequirementBuilder.fromUri(uri).build());
 		}

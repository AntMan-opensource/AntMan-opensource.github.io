commit 6e83e34af5d028ec3c2d85f6cb2505b645baa6d3
Author: gustavolimav <gustavo.lima@liferay.com>
Date:   Tue Jan 17 12:25:47 2023 -0300

    LPS-172811 portal-kernel: Filter AssetRenderFactories with new property companyId to inlcude use case when DB Partition

diff --git a/portal-kernel/src/com/liferay/asset/kernel/AssetRendererFactoryRegistryUtil.java b/portal-kernel/src/com/liferay/asset/kernel/AssetRendererFactoryRegistryUtil.java
index 0c89683ef3c10..a731deabb83f5 100644
--- a/portal-kernel/src/com/liferay/asset/kernel/AssetRendererFactoryRegistryUtil.java
+++ b/portal-kernel/src/com/liferay/asset/kernel/AssetRendererFactoryRegistryUtil.java
@@ -18,6 +18,7 @@ import com.liferay.asset.kernel.model.AssetRendererFactory;
 import com.liferay.osgi.service.tracker.collections.map.ServiceTrackerMap;
 import com.liferay.osgi.service.tracker.collections.map.ServiceTrackerMapFactory;
 import com.liferay.portal.kernel.module.util.SystemBundleUtil;
+import com.liferay.portal.kernel.util.GetterUtil;
 import com.liferay.portal.kernel.util.ListUtil;
 import com.liferay.portal.kernel.util.PortalUtil;
 
@@ -140,7 +141,12 @@ public class AssetRendererFactoryRegistryUtil {
 			AssetRendererFactory<?> assetRendererFactory =
 				assetRendererFactories.getService(key);
 
-			if (assetRendererFactory.isActive(companyId) &&
+			if (key.startsWith("com.liferay.object.model.ObjectDefinition#")) {
+
+				if (key.split("#")[2].equals(Long.toString(companyId))) {
+					filteredAssetRendererFactories.put(key, assetRendererFactory);
+				}
+			} else if (assetRendererFactory.isActive(companyId) &&
 				(!filterSelectable || assetRendererFactory.isSelectable())) {
 
 				filteredAssetRendererFactories.put(key, assetRendererFactory);
@@ -167,7 +173,13 @@ public class AssetRendererFactoryRegistryUtil {
 					AssetRendererFactory<?> assetRendererFactory =
 						_bundleContext.getService(serviceReference);
 
-					emitter.emit(assetRendererFactory.getClassName());
+					String className = assetRendererFactory.getClassName();
+
+					if (className.startsWith("com.liferay.object.model.ObjectDefinition#")) {
+						emitter.emit(className + "#" + GetterUtil.getLong(serviceReference.getProperty("company.id")));
+					} else {
+						emitter.emit(className);
+					}
 				});
 
 	private static final ServiceTrackerMap<String, AssetRendererFactory<?>>

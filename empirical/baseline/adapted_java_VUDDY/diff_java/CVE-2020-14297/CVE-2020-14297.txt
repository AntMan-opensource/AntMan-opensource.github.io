commit e5f8e4b591f1698a53adc7e430584ca2a8fc9f1b
Author: Flavia Rainone <frainone@redhat.com>
Date:   Tue Jul 7 14:01:10 2020 -0300

    [EJBCLIENT-378] Make sure transaction related invocations are removed after response is received.

diff --git a/src/main/java/org/jboss/ejb/protocol/remote/EJBSimpleTransactionControl.java b/src/main/java/org/jboss/ejb/protocol/remote/EJBSimpleTransactionControl.java
index af323940..807d5c01 100644
--- a/src/main/java/org/jboss/ejb/protocol/remote/EJBSimpleTransactionControl.java
+++ b/src/main/java/org/jboss/ejb/protocol/remote/EJBSimpleTransactionControl.java
@@ -104,6 +104,8 @@ class EJBSimpleTransactionControl implements SimpleTransactionControl {
             throw new SystemException();
         } catch (IOException e) {
             throw new SystemException();
+        } finally {
+            invocationTracker.remove(invocation);
         }
     }
 
diff --git a/src/main/java/org/jboss/ejb/protocol/remote/EJBTransactionOperations.java b/src/main/java/org/jboss/ejb/protocol/remote/EJBTransactionOperations.java
index d41c1243..cb110f5c 100644
--- a/src/main/java/org/jboss/ejb/protocol/remote/EJBTransactionOperations.java
+++ b/src/main/java/org/jboss/ejb/protocol/remote/EJBTransactionOperations.java
@@ -125,6 +125,8 @@ class EJBTransactionOperations implements RemotingOperations {
             throw new XAException(XAException.XAER_RMERR);
         } catch (IOException e) {
             throw new XAException(XAException.XAER_RMERR);
+        } finally {
+            invocationTracker.remove(invocation);
         }
     }
 
@@ -204,6 +206,8 @@ class EJBTransactionOperations implements RemotingOperations {
             throw new XAException(XAException.XAER_RMERR);
         } catch (IOException | ClassNotFoundException e) {
             throw new XAException(XAException.XAER_RMERR);
+        } finally {
+            invocationTracker.remove(invocation);
         }
     }
 

commit fb239e9826ad2570cfaf86f80abbddd960cae541
Author: Thomas Mortagne <thomas.mortagne@gmail.com>
Date:   Wed Dec 7 17:59:14 2022 +0100

    XWIKI-20460: Improve translations loading
    
    (cherry picked from commit 0cc06825a4e6c854770db0eaed0597f9383289d2)

diff --git a/xwiki-platform-core/xwiki-platform-localization/xwiki-platform-localization-sources/xwiki-platform-localization-source-wiki/src/main/java/org/xwiki/localization/wiki/internal/DocumentTranslationBundleFactory.java b/xwiki-platform-core/xwiki-platform-localization/xwiki-platform-localization-sources/xwiki-platform-localization-source-wiki/src/main/java/org/xwiki/localization/wiki/internal/DocumentTranslationBundleFactory.java
index 5e956836ceb..cc556e31a4d 100644
--- a/xwiki-platform-core/xwiki-platform-localization/xwiki-platform-localization-sources/xwiki-platform-localization-source-wiki/src/main/java/org/xwiki/localization/wiki/internal/DocumentTranslationBundleFactory.java
+++ b/xwiki-platform-core/xwiki-platform-localization/xwiki-platform-localization-sources/xwiki-platform-localization-source-wiki/src/main/java/org/xwiki/localization/wiki/internal/DocumentTranslationBundleFactory.java
@@ -216,6 +216,7 @@ private void loadTranslations(String wiki)
         XWikiContext xcontext = this.xcontextProvider.get();
         WikiReference wikiReference = new WikiReference(wiki);
 
+        List<String> documents;
         try {
             Query query =
                 this.queryManager.createQuery(String.format(
@@ -223,21 +224,25 @@ private void loadTranslations(String wiki)
                     TranslationDocumentModel.TRANSLATIONCLASS_REFERENCE_STRING), Query.XWQL);
 
             query.setWiki(wiki);
-            
-            List<String> documents = query.execute();
-            for (String documentName : documents) {
-                DocumentReference reference = currentResolver.resolve(documentName, wikiReference);
+
+            documents = query.execute();
+        } catch (Exception e) {
+            this.logger.error("Failed to find translation documents", e);
+
+            return ;
+        }
+
+        for (String documentName : documents) {
+            DocumentReference reference = this.currentResolver.resolve(documentName, wikiReference);
+
+            try {
                 XWikiDocument document = xcontext.getWiki().getDocument(reference, xcontext);
 
-                try {
-                    registerTranslationBundle(document);
-                } catch (Exception e) {
-                    this.logger.error("Failed to register translation bundle from document [{}]",
-                        document.getDocumentReference(), e);
-                }
+                registerTranslationBundle(document);
+            } catch (Exception e) {
+                this.logger.error("Failed to load and register the translation bundle from document [{}]", reference,
+                    e);
             }
-        } catch (Exception e) {
-            this.logger.error("Failed to load existing translations", e);
         }
     }
 

commit 0ba4274d545eac39e3db48b5dfb4512db3242946
Author: Ajay Asati <117740822+aasat@users.noreply.github.com>
Date:   Fri Dec 9 13:45:47 2022 +0530

    SECURITY-2624:Missing permission check (#51)
    
    * SECURITY-2624:Missing permission check
    
    * SECURITY-2623:Missing permission check-Changed copyright

diff --git a/src/main/java/com/compuware/jenkins/totaltest/TotalTestBuilder.java b/src/main/java/com/compuware/jenkins/totaltest/TotalTestBuilder.java
index 328f695..0d8ec67 100644
--- a/src/main/java/com/compuware/jenkins/totaltest/TotalTestBuilder.java
+++ b/src/main/java/com/compuware/jenkins/totaltest/TotalTestBuilder.java
@@ -2,7 +2,7 @@
  * The MIT License (MIT)
  * 
  * Copyright (c) 2015 - 2020 Compuware Corporation
- * 
+  * (c) Copyright 2020 - 2022 BMC Software, Inc.
  * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
  * files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy,
  * modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the
@@ -798,6 +798,13 @@ public class TotalTestBuilder extends AbstractTotalTestBuilderMigration implemen
 		public ListBoxModel doFillConnectionIdItems(@AncestorInPath Jenkins context, @QueryParameter String connectionId,
 				@AncestorInPath Item project)
 		{
+			
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+			
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
 			HostConnection[] hostConnections = globalConfig.getHostConnections();
 
@@ -856,6 +863,12 @@ public class TotalTestBuilder extends AbstractTotalTestBuilderMigration implemen
 		 */
 		public ListBoxModel doFillCredentialsIdItems(@AncestorInPath final Jenkins context, @QueryParameter final String credentialsId, @AncestorInPath final Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+			
 			List<StandardUsernamePasswordCredentials> creds = CredentialsProvider
 					.lookupCredentials(StandardUsernamePasswordCredentials.class, project, ACL.SYSTEM,
 							Collections.<DomainRequirement> emptyList());
diff --git a/src/main/java/com/compuware/jenkins/totaltest/TotalTestCTBuilder.java b/src/main/java/com/compuware/jenkins/totaltest/TotalTestCTBuilder.java
index c918b65..a28b8fb 100644
--- a/src/main/java/com/compuware/jenkins/totaltest/TotalTestCTBuilder.java
+++ b/src/main/java/com/compuware/jenkins/totaltest/TotalTestCTBuilder.java
@@ -2,7 +2,7 @@
  * The MIT License (MIT)
  * 
  * Copyright (c) 2019-2020 Compuware Corporation
- * (c) Copyright 2019-2020 BMC Software, Inc.
+ * (c) Copyright 2019-2020, 2022 BMC Software, Inc.
  * 
  * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation
  * files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy,
@@ -1534,6 +1534,12 @@ public class TotalTestCTBuilder extends Builder implements SimpleBuildStep
 		public ListBoxModel doFillConnectionIdItems(@AncestorInPath Jenkins context, @QueryParameter String connectionId,
 				@AncestorInPath Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+			
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
 			HostConnection[] hostConnections = globalConfig.getHostConnections();
 
@@ -1644,6 +1650,11 @@ public class TotalTestCTBuilder extends Builder implements SimpleBuildStep
 		public ListBoxModel doFillCredentialsIdItems(@AncestorInPath final Jenkins context, //NOSONAR
 				@QueryParameter final String credentialsId, @AncestorInPath final Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
 			List<StandardUsernamePasswordCredentials> creds = CredentialsProvider.lookupCredentials(
 					StandardUsernamePasswordCredentials.class, project, ACL.SYSTEM,
 					Collections.<DomainRequirement> emptyList());
@@ -1678,9 +1689,14 @@ public class TotalTestCTBuilder extends Builder implements SimpleBuildStep
 		 * @return serverUrl selections
 		 * 
 		 */
-		public ListBoxModel doFillServerUrlItems(@QueryParameter String serverUrl)
+		public ListBoxModel doFillServerUrlItems(@QueryParameter String serverUrl,@AncestorInPath final Item project)
 		{
-
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+			
 			ListBoxModel model = new ListBoxModel();
 			model.add(new Option("", "", false)); //$NON-NLS-1$ //$NON-NLS-2$
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
@@ -1740,6 +1756,12 @@ public class TotalTestCTBuilder extends Builder implements SimpleBuildStep
 		public ListBoxModel doFillServerCredentialsIdItems(@AncestorInPath final Jenkins context, //NOSONAR
 				@QueryParameter final String serverCredentialsId, @AncestorInPath final Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+			
 			List<StandardUsernamePasswordCredentials> creds = CredentialsProvider.lookupCredentials(
 					StandardUsernamePasswordCredentials.class, project, ACL.SYSTEM,
 					Collections.<DomainRequirement> emptyList());

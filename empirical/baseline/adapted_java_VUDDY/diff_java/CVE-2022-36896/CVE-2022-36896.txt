commit bf00665b13641351a9f67027bbe34609cc4f65e2
Author: vaibhjai <vaibhav_jain2@bmc.com>
Date:   Mon May 16 15:17:04 2022 +0530

    SECURITY-2621: Added Missing permission checks.

diff --git a/src/main/java/com/compuware/jenkins/scm/AbstractConfiguration.java b/src/main/java/com/compuware/jenkins/scm/AbstractConfiguration.java
index a386bbc..936bd9d 100644
--- a/src/main/java/com/compuware/jenkins/scm/AbstractConfiguration.java
+++ b/src/main/java/com/compuware/jenkins/scm/AbstractConfiguration.java
@@ -106,6 +106,12 @@ public abstract class AbstractConfiguration extends SCM
 		 */
 		public ListBoxModel doFillCredentialsIdItems(@AncestorInPath Jenkins context, @QueryParameter String credentialsId,
 				@AncestorInPath Item project) {
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+		
 			List<StandardCredentials> creds = CredentialsProvider.lookupCredentials(StandardCredentials.class, project, ACL.SYSTEM,
 					Collections.<DomainRequirement>emptyList());
 
diff --git a/src/main/java/com/compuware/jenkins/scm/EndevorConfiguration.java b/src/main/java/com/compuware/jenkins/scm/EndevorConfiguration.java
index c49cd34..4a1eed7 100644
--- a/src/main/java/com/compuware/jenkins/scm/EndevorConfiguration.java
+++ b/src/main/java/com/compuware/jenkins/scm/EndevorConfiguration.java
@@ -255,6 +255,12 @@ public class EndevorConfiguration extends CpwrScmConfiguration
 		public ListBoxModel doFillConnectionIdItems(@AncestorInPath Jenkins context, @QueryParameter String connectionId,
 				@AncestorInPath Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
 			HostConnection[] hostConnections = globalConfig.getHostConnections();
 
diff --git a/src/main/java/com/compuware/jenkins/scm/IspwConfiguration.java b/src/main/java/com/compuware/jenkins/scm/IspwConfiguration.java
index 34cc5d9..c9da72e 100644
--- a/src/main/java/com/compuware/jenkins/scm/IspwConfiguration.java
+++ b/src/main/java/com/compuware/jenkins/scm/IspwConfiguration.java
@@ -416,6 +416,12 @@ public class IspwConfiguration extends AbstractIspwConfiguration
 		public ListBoxModel doFillConnectionIdItems(@AncestorInPath Jenkins context, @QueryParameter String connectionId,
 				@AncestorInPath Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
 			HostConnection[] hostConnections = globalConfig.getHostConnections();
 
diff --git a/src/main/java/com/compuware/jenkins/scm/IspwContainerConfiguration.java b/src/main/java/com/compuware/jenkins/scm/IspwContainerConfiguration.java
index 4b3c6d1..41cd3d5 100644
--- a/src/main/java/com/compuware/jenkins/scm/IspwContainerConfiguration.java
+++ b/src/main/java/com/compuware/jenkins/scm/IspwContainerConfiguration.java
@@ -312,6 +312,12 @@ public class IspwContainerConfiguration extends AbstractIspwConfiguration
 		public ListBoxModel doFillConnectionIdItems(@AncestorInPath Jenkins context, @QueryParameter String connectionId,
 				@AncestorInPath Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
 			HostConnection[] hostConnections = globalConfig.getHostConnections();
 
diff --git a/src/main/java/com/compuware/jenkins/scm/PdsConfiguration.java b/src/main/java/com/compuware/jenkins/scm/PdsConfiguration.java
index c01e6a0..ece24ed 100644
--- a/src/main/java/com/compuware/jenkins/scm/PdsConfiguration.java
+++ b/src/main/java/com/compuware/jenkins/scm/PdsConfiguration.java
@@ -254,6 +254,12 @@ public class PdsConfiguration extends CpwrScmConfiguration
 		public ListBoxModel doFillConnectionIdItems(@AncestorInPath Jenkins context, @QueryParameter String connectionId,
 				@AncestorInPath Item project)
 		{
+			if (project == null) {
+				Jenkins.get().checkPermission(Jenkins.ADMINISTER);
+			} else {
+				project.checkPermission(Item.CONFIGURE);
+			}
+
 			CpwrGlobalConfiguration globalConfig = CpwrGlobalConfiguration.get();
 			HostConnection[] hostConnections = globalConfig.getHostConnections();
 

commit a8901ed813d7453beacbcf174bac46f35940feea
Author: Colm O hEigeartaigh <coheigea@apache.org>
Date:   Mon Dec 19 10:51:37 2022 +0000

    Using FilterBuilder in the LdapIdentityBackend

diff --git a/kerby-backend/ldap-backend/src/main/java/org/apache/kerby/kerberos/kdc/identitybackend/LdapIdentityBackend.java b/kerby-backend/ldap-backend/src/main/java/org/apache/kerby/kerberos/kdc/identitybackend/LdapIdentityBackend.java
index 881d76f3..01e4cffe 100644
--- a/kerby-backend/ldap-backend/src/main/java/org/apache/kerby/kerberos/kdc/identitybackend/LdapIdentityBackend.java
+++ b/kerby-backend/ldap-backend/src/main/java/org/apache/kerby/kerberos/kdc/identitybackend/LdapIdentityBackend.java
@@ -35,6 +35,7 @@ import org.apache.directory.api.ldap.model.name.Rdn;
 import org.apache.directory.api.util.GeneralizedTime;
 import org.apache.directory.ldap.client.api.LdapConnection;
 import org.apache.directory.ldap.client.api.LdapNetworkConnection;
+import org.apache.directory.ldap.client.api.search.FilterBuilder;
 import org.apache.directory.shared.kerberos.KerberosAttribute;
 import org.apache.kerby.config.Config;
 import org.apache.kerby.kerberos.kerb.KrbException;
@@ -296,8 +297,10 @@ public class LdapIdentityBackend extends AbstractIdentityBackend {
     @Override
     protected KrbIdentity doGetIdentity(String principalName) throws KrbException {
         KrbIdentity krbIdentity = new KrbIdentity(principalName);
-        String searchFilter =
-            String.format("(&(objectclass=krb5principal)(krb5PrincipalName=%s))", principalName);
+        String searchFilter = FilterBuilder.and(
+                FilterBuilder.equal("objectclass", "krb5principal"),
+                FilterBuilder.equal("krb5PrincipalName", principalName)
+        ).toString();
         try {
             EntryCursor cursor = new FailoverInvocationHandler<EntryCursor>() {
                 @Override

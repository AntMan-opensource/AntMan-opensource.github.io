commit 5976cb68c6190658b5a4198b278d8a8c24deb71e
Author: Jiefeng Wu <jeffwu0724@gmail.com>
Date:   Fri May 6 17:31:37 2022 -0700

    LPS-149266 - add check to ZipSlip vulnerability in FileImpl

diff --git a/portal-impl/src/com/liferay/portal/util/FileImpl.java b/portal-impl/src/com/liferay/portal/util/FileImpl.java
index 10f8fd38191d0..e723aaea4f4e4 100644
--- a/portal-impl/src/com/liferay/portal/util/FileImpl.java
+++ b/portal-impl/src/com/liferay/portal/util/FileImpl.java
@@ -778,6 +778,22 @@ public class FileImpl implements com.liferay.portal.kernel.util.File {
 			while ((entry = zipInputStream.getNextEntry()) != null) {
 				File destinationFile = new File(destination, entry.getName());
 
+				String destinationFileCanonicalPath =
+					destinationFile.getCanonicalPath();
+
+				if (!destinationFileCanonicalPath.startsWith(
+						destination.getCanonicalPath() + File.separator)) {
+
+					if (_log.isWarnEnabled()) {
+						_log.warn(
+							StringBundler.concat(
+								"Entry Name: ", entry.getName(),
+								" is not valid"));
+					}
+
+					continue;
+				}
+
 				if (entry.isDirectory()) {
 					destinationFile.mkdirs();
 				}

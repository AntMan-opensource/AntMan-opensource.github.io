commit b5b26e35da2232c91a549268a1b7890326f7e600
Author: Simon Urli <simon.urli@xwiki.com>
Date:   Mon Jan 25 11:43:22 2021 +0100

    XWIKI-18276: Remove wrong annotation on authentication script service

diff --git a/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java b/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java
index b73867674a9..c3661d5f94a 100644
--- a/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java
+++ b/xwiki-platform-core/xwiki-platform-security/xwiki-platform-security-authentication/xwiki-platform-security-authentication-script/src/main/java/org/xwiki/security/authentication/script/AuthenticationScriptService.java
@@ -35,10 +35,11 @@
 import org.xwiki.security.authentication.api.AuthenticationConfiguration;
 import org.xwiki.security.authentication.api.AuthenticationFailureManager;
 import org.xwiki.security.authentication.api.AuthenticationFailureStrategy;
+import org.xwiki.security.authorization.ContextualAuthorizationManager;
+import org.xwiki.security.authorization.Right;
 import org.xwiki.security.script.SecurityScriptService;
 
 import com.xpn.xwiki.XWikiContext;
-import com.xpn.xwiki.util.Programming;
 
 /**
  * Security Authentication Script service.
@@ -68,6 +69,9 @@ public class AuthenticationScriptService implements ScriptService
     @Inject
     private Provider<XWikiContext> contextProvider;
 
+    @Inject
+    private ContextualAuthorizationManager authorizationManager;
+
     @Inject
     private Logger logger;
 
@@ -116,9 +120,10 @@ public AuthenticationConfiguration getAuthenticationConfiguration()
      * Reset the authentication failure record for the given username.
      * @param username the username for which to remove the record.
      */
-    @Programming
     public void resetAuthenticationFailureCounter(String username)
     {
-        this.authenticationFailureManager.resetAuthenticationFailureCounter(username);
+        if (this.authorizationManager.hasAccess(Right.PROGRAM)) {
+            this.authenticationFailureManager.resetAuthenticationFailureCounter(username);
+        }
     }
 }
